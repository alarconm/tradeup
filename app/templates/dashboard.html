<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeUp Dashboard</title>
    <style>
        :root {
            --primary: #e85d27;
            --primary-dark: #c94e1f;
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --text: #eee;
            --text-muted: #aaa;
            --success: #22c55e;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
        }

        .header {
            background: var(--bg-card);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header h1 span {
            color: var(--primary);
        }

        .main {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .stat-card__label {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .stat-card__value {
            font-size: 2rem;
            font-weight: 700;
        }

        .stat-card__change {
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .stat-card__change--up { color: var(--success); }
        .stat-card__change--down { color: #ef4444; }

        .section {
            background: var(--bg-card);
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .section__header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section__title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .section__body {
            padding: 1.5rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .table th {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 0.875rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge--success {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .badge--warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .badge--pending {
            background: rgba(255,255,255,0.1);
            color: var(--text-muted);
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn--primary {
            background: var(--primary);
            color: white;
        }

        .btn--primary:hover {
            background: var(--primary-dark);
        }

        .btn--secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text);
        }

        .quick-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .action-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 12px;
            padding: 1.5rem;
            flex: 1;
            min-width: 200px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .action-card:hover {
            transform: translateY(-2px);
        }

        .action-card__icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .action-card__title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .action-card__desc {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .member-search {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .member-search input {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: var(--text);
            font-size: 1rem;
        }

        .member-search input::placeholder {
            color: var(--text-muted);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state__icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            .main {
                padding: 1rem;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1><span>TradeUp</span> Employee Dashboard</h1>
        <div>
            <span id="tenantName">ORB Sports Cards</span>
        </div>
    </header>

    <main class="main">
        <!-- Quick Actions -->
        <div class="quick-actions" style="margin-bottom: 2rem;">
            <div class="action-card" onclick="showNewMemberModal()">
                <div class="action-card__icon">üë§</div>
                <div class="action-card__title">New Member</div>
                <div class="action-card__desc">Register a new TradeUp member</div>
            </div>
            <div class="action-card" onclick="showNewTradeInModal()">
                <div class="action-card__icon">üì¶</div>
                <div class="action-card__title">New Trade-In</div>
                <div class="action-card__desc">Create a trade-in batch</div>
            </div>
            <div class="action-card" onclick="processBonuses()">
                <div class="action-card__icon">üéÅ</div>
                <div class="action-card__title">Process Bonuses</div>
                <div class="action-card__desc">Issue pending bonuses</div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card__label">Active Members</div>
                <div class="stat-card__value" id="activeMembers">--</div>
                <div class="stat-card__change stat-card__change--up">‚Üë 5 this month</div>
            </div>
            <div class="stat-card">
                <div class="stat-card__label">Trade-Ins This Month</div>
                <div class="stat-card__value" id="tradeInsMonth">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-card__label">Bonuses Issued</div>
                <div class="stat-card__value" id="bonusesIssued">$--</div>
                <div class="stat-card__change stat-card__change--up">‚Üë 12% vs last month</div>
            </div>
            <div class="stat-card">
                <div class="stat-card__label">Trade-In Completion Rate</div>
                <div class="stat-card__value" id="successRate">--%</div>
                <div class="stat-card__change">Completed trade-ins</div>
            </div>
        </div>

        <!-- Member Search -->
        <section class="section">
            <div class="section__header">
                <h2 class="section__title">Members</h2>
                <button class="btn btn--primary" onclick="showNewMemberModal()">+ Add Member</button>
            </div>
            <div class="section__body">
                <div class="member-search">
                    <input type="text" id="memberSearch" placeholder="Search by name, email, or member # (e.g., QF1001)">
                    <button class="btn btn--secondary" onclick="searchMembers()">Search</button>
                </div>
                <table class="table" id="membersTable">
                    <thead>
                        <tr>
                            <th>Member #</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Tier</th>
                            <th>Total Bonus</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membersBody">
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <div class="empty-state__icon">üë•</div>
                                    <div>Loading members...</div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Pending Bonuses -->
        <section class="section">
            <div class="section__header">
                <h2 class="section__title">Pending Bonuses</h2>
                <button class="btn btn--primary" onclick="processBonuses()">Process All</button>
            </div>
            <div class="section__body">
                <table class="table" id="pendingBonusesTable">
                    <thead>
                        <tr>
                            <th>Member</th>
                            <th>Product</th>
                            <th>Sold Price</th>
                            <th>Days to Sell</th>
                            <th>Bonus Amount</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="pendingBonusesBody">
                        <tr>
                            <td colspan="6">
                                <div class="empty-state">
                                    <div class="empty-state__icon">üéÅ</div>
                                    <div>No pending bonuses</div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="section">
            <div class="section__header">
                <h2 class="section__title">Recent Trade-Ins</h2>
                <button class="btn btn--secondary" onclick="showNewTradeInModal()">+ New Trade-In</button>
            </div>
            <div class="section__body">
                <table class="table" id="recentTradeInsTable">
                    <thead>
                        <tr>
                            <th>Batch #</th>
                            <th>Member</th>
                            <th>Date</th>
                            <th>Items</th>
                            <th>Total Value</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recentTradeInsBody">
                        <tr>
                            <td colspan="6">
                                <div class="empty-state">
                                    <div class="empty-state__icon">üì¶</div>
                                    <div>No recent trade-ins</div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        const API_BASE = '/api';

        // Load dashboard data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardStats();
            loadMembers();
            loadPendingBonuses();
            loadRecentTradeIns();
        });

        async function loadDashboardStats() {
            try {
                const response = await fetch(`${API_BASE}/dashboard/stats`);
                const data = await response.json();

                document.getElementById('activeMembers').textContent = data.members?.active || 0;
                document.getElementById('tradeInsMonth').textContent = data.trade_ins_this_month || 0;
                document.getElementById('bonusesIssued').textContent = '$' + (data.bonuses_this_month?.total || 0).toFixed(2);
                document.getElementById('successRate').textContent = (data.completion_rate || 0) + '%';
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        async function loadMembers() {
            try {
                const response = await fetch(`${API_BASE}/members?per_page=10`);
                const data = await response.json();

                const tbody = document.getElementById('membersBody');

                if (!data.members || data.members.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <div class="empty-state__icon">üë•</div>
                                    <div>No members yet. Add your first member!</div>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = data.members.map(member => `
                    <tr>
                        <td><strong>${member.member_number}</strong></td>
                        <td>${member.name || '-'}</td>
                        <td>${member.email}</td>
                        <td>${member.tier?.name || '-'}</td>
                        <td>$${(member.stats?.total_bonus_earned || 0).toFixed(2)}</td>
                        <td>
                            <span class="badge badge--${member.status === 'active' ? 'success' : 'pending'}">
                                ${member.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn--secondary" onclick="viewMember(${member.id})">View</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Failed to load members:', error);
            }
        }

        async function loadPendingBonuses() {
            try {
                const response = await fetch(`${API_BASE}/bonuses/pending`);
                const data = await response.json();

                const tbody = document.getElementById('pendingBonusesBody');

                if (!data.items || data.items.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6">
                                <div class="empty-state">
                                    <div class="empty-state__icon">‚úÖ</div>
                                    <div>No pending bonuses - all caught up!</div>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = data.items.map(item => `
                    <tr>
                        <td>${item.batch?.member?.member_number || '-'}</td>
                        <td>${item.product_title || '-'}</td>
                        <td>$${(item.sold_price || 0).toFixed(2)}</td>
                        <td>${item.days_to_sell || '-'} days</td>
                        <td><strong>$${(item.bonus_amount || 0).toFixed(2)}</strong></td>
                        <td>
                            <span class="badge badge--warning">Pending</span>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Failed to load pending bonuses:', error);
            }
        }

        async function loadRecentTradeIns() {
            try {
                const response = await fetch(`${API_BASE}/trade-ins?per_page=10`);
                const data = await response.json();

                const tbody = document.getElementById('recentTradeInsBody');

                if (!data.batches || data.batches.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6">
                                <div class="empty-state">
                                    <div class="empty-state__icon">üì¶</div>
                                    <div>No trade-ins yet</div>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = data.batches.map(batch => `
                    <tr>
                        <td><strong>${batch.batch_reference}</strong></td>
                        <td>${batch.member_number || '-'}</td>
                        <td>${new Date(batch.trade_in_date).toLocaleDateString()}</td>
                        <td>${batch.total_items}</td>
                        <td>$${(batch.total_trade_value || 0).toFixed(2)}</td>
                        <td>
                            <span class="badge badge--${batch.status === 'completed' ? 'success' : batch.status === 'listed' ? 'warning' : 'pending'}">
                                ${batch.status}
                            </span>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Failed to load trade-ins:', error);
            }
        }

        function searchMembers() {
            const query = document.getElementById('memberSearch').value;
            // TODO: Implement search
            alert('Search: ' + query);
        }

        function viewMember(memberId) {
            // TODO: Open member detail modal
            alert('View member: ' + memberId);
        }

        function showNewMemberModal() {
            // TODO: Implement member creation modal
            alert('TODO: New Member Modal');
        }

        function showNewTradeInModal() {
            // TODO: Implement trade-in creation modal
            alert('TODO: New Trade-In Modal');
        }

        async function processBonuses() {
            if (!confirm('Process all pending bonuses?')) return;

            try {
                const response = await fetch(`${API_BASE}/bonuses/process`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ created_by: 'dashboard' })
                });

                const data = await response.json();

                if (data.issued > 0) {
                    alert(`Issued ${data.issued} bonuses totaling $${data.total_bonus_amount.toFixed(2)}`);
                } else {
                    alert('No bonuses to process');
                }

                // Reload data
                loadDashboardStats();
                loadPendingBonuses();
            } catch (error) {
                console.error('Failed to process bonuses:', error);
                alert('Error processing bonuses');
            }
        }
    </script>
</body>
</html>
