import{b as U,u as Y,c as O,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as C,R as Q}from"./vendor-router-CdtyvhQv.js";import{a as R,g as B}from"./index-CIr4Wx79.js";import{P as H,C as z}from"./ColorPicker-P_Ivpuso.js";import{P as F,C as T,a as g,l as K,T as l,B as q,an as J,ao as X,ap as Z,a9 as ee,a6 as ne,L as P,c as W,h as y,b as m,I as te,t as oe,ae,aq as se,M as G,a3 as ie,z as L,f as S,m as re,n as le,q as ce,e as N,g as b,N as p}from"./vendor-polaris-vFYxDTRx.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";const D={points_balance:{type:"points_balance",name:"Points Balance",description:"Floating widget showing customer's current points balance",icon:ee,preview:"500 pts"},tier_badge:{type:"tier_badge",name:"Tier Badge",description:"Badge displaying customer's membership tier",icon:Z,preview:"Gold"},rewards_launcher:{type:"rewards_launcher",name:"Rewards Launcher",description:"Button to open the rewards panel",icon:X,preview:"icon"},referral_prompt:{type:"referral_prompt",name:"Referral Prompt",description:"Promotional banner encouraging referrals",icon:J,preview:"Share & Earn!"}},de=[{label:"Bottom Right",value:"bottom-right"},{label:"Bottom Left",value:"bottom-left"},{label:"Top Right",value:"top-right"},{label:"Top Left",value:"top-left"},{label:"Top Center",value:"top-center"},{label:"Bottom Center",value:"bottom-center"}],ge=[{label:"Gift",value:"gift"},{label:"Star",value:"star"},{label:"Heart",value:"heart"},{label:"Trophy",value:"trophy"},{label:"Coin",value:"coin"}],he=[{label:"Pill",value:"pill"},{label:"Square",value:"square"},{label:"Rounded",value:"rounded"}],ue=[{label:"On Scroll",value:"scroll"},{label:"After Delay",value:"delay"},{label:"Exit Intent",value:"exit_intent"},{label:"Immediately",value:"immediate"}];async function pe(t){const i=await R(`${B()}/widgets`,t);if(!i.ok)throw new Error("Failed to fetch widgets");return i.json()}async function be(t,i,c){const u=await R(`${B()}/widgets/${i}`,t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!u.ok)throw new Error("Failed to update widget");return u.json()}async function xe(t,i,c){const u=c?"enable":"disable",r=await R(`${B()}/widgets/${i}/${u}`,t,{method:"POST"});if(!r.ok)throw new Error("Failed to toggle widget");return r.json()}async function fe(t,i){const c=await R(`${B()}/widgets/${i}/reset`,t,{method:"POST"});if(!c.ok)throw new Error("Failed to reset widget");return c.json()}function _e({widget:t,metadata:i,onToggle:c,onConfigure:u,isToggling:r}){const d=i.icon;return e.jsx(T,{children:e.jsxs(g,{gap:"400",children:[e.jsxs(y,{align:"space-between",blockAlign:"center",children:[e.jsxs(y,{gap:"300",blockAlign:"center",children:[e.jsx(m,{padding:"300",borderRadius:"200",background:t.is_enabled?"bg-fill-success":"bg-surface-secondary",children:e.jsx(te,{source:d,tone:t.is_enabled?"base":"subdued"})}),e.jsxs(g,{gap:"050",children:[e.jsxs(y,{gap:"200",blockAlign:"center",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:i.name}),e.jsx(oe,{tone:t.is_enabled?"success":void 0,children:t.is_enabled?"Enabled":"Disabled"})]}),e.jsx(l,{as:"p",variant:"bodySm",tone:"subdued",children:i.description})]})]}),e.jsxs(y,{gap:"200",children:[e.jsx(ae,{content:t.is_enabled?"Disable widget":"Enable widget",children:e.jsx(W,{onClick:()=>c(!t.is_enabled),loading:r,variant:t.is_enabled?void 0:"primary",children:t.is_enabled?"Disable":"Enable"})}),e.jsx(W,{onClick:u,icon:se,children:"Configure"})]})]}),e.jsx(m,{padding:"300",background:"bg-surface-secondary",borderRadius:"200",children:e.jsx(y,{align:"center",children:e.jsx($,{widget:t,metadata:i})})})]})})}function $({widget:t,metadata:i}){const{config:c,widget_type:u}=t,r=c.styling||{},d=c.content||{},j={backgroundColor:r.background_color||"#000000",color:r.text_color||"#ffffff",borderRadius:r.border_radius||12,padding:"12px 16px",fontSize:r.font_size||14,boxShadow:r.shadow!==!1?"0 4px 12px rgba(0,0,0,0.15)":"none",display:"flex",alignItems:"center",gap:"8px"};switch(u){case"points_balance":return e.jsxs("div",{style:j,children:[d.show_icon!==!1&&e.jsx("span",{children:"â­"}),e.jsxs("span",{style:{fontWeight:600},children:[d.label_text||"Your Points",": ",i.preview]})]});case"tier_badge":const x={...j,borderRadius:r.badge_style==="square"?4:r.badge_style==="rounded"?8:20,padding:"6px 12px"};return e.jsxs("div",{style:x,children:[d.show_tier_icon!==!1&&e.jsx("span",{children:"ðŸ‘‘"}),d.show_tier_name!==!1&&e.jsx("span",{style:{fontWeight:600},children:i.preview})]});case"rewards_launcher":const w={width:r.size||56,height:r.size||56,borderRadius:"50%",backgroundColor:r.background_color||"#e85d27",color:r.icon_color||"#ffffff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,boxShadow:r.shadow!==!1?"0 4px 12px rgba(0,0,0,0.15)":"none",cursor:"pointer"},_={gift:"ðŸŽ",star:"â­",heart:"â¤",trophy:"ðŸ†",coin:"ðŸª™"};return e.jsx("div",{style:w,children:_[d.icon||"gift"]||"ðŸŽ"});case"referral_prompt":const v={...j,flexDirection:"column",alignItems:"flex-start",gap:"8px",maxWidth:"300px"};return e.jsxs("div",{style:v,children:[e.jsx("span",{style:{fontWeight:600,fontSize:16},children:d.title||"Share & Earn!"}),e.jsx("span",{style:{fontSize:12,opacity:.9},children:d.description||"Refer a friend and you both get rewarded"}),e.jsx("span",{style:{marginTop:4,padding:"6px 12px",backgroundColor:r.accent_color||"#e85d27",borderRadius:4,fontSize:12,fontWeight:600},children:d.cta_text||"Get Your Link"})]});default:return null}}function je({widget:t,metadata:i,open:c,onClose:u,onSave:r,onReset:d,isSaving:j}){const[x,w]=C.useState(t.config),[_,v]=C.useState(!1);Q.useEffect(()=>{w(t.config)},[t.config]);const a=C.useCallback((o,n,h)=>{w(s=>({...s,[o]:{...s[o],[n]:h}}))},[]),k=()=>{r(x)},I=()=>{const o=x.position||{},n=o.type==="fixed"||t.widget_type!=="tier_badge";return e.jsxs(g,{gap:"400",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Position"}),n?e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"Position",options:de,value:o.location||"bottom-right",onChange:h=>a("position","location",h)}),e.jsx(W,{onClick:()=>v(!_),icon:_?re:le,children:_?"Hide Visual Selector":"Use Visual Selector"}),e.jsx(ce,{open:_,id:"position-selector",children:e.jsx(m,{paddingBlockStart:"200",children:e.jsx(H,{value:o.location||"bottom-right",onChange:h=>a("position","location",h),showTabPositions:!1,helpText:"Click a position to place your widget"})})}),e.jsxs(N.Group,{children:[e.jsx(b,{label:"Horizontal Offset (px)",type:"number",value:String(o.offset_x||20),onChange:h=>a("position","offset_x",parseInt(h)),autoComplete:"off"}),e.jsx(b,{label:"Vertical Offset (px)",type:"number",value:String(o.offset_y||20),onChange:h=>a("position","offset_y",parseInt(h)),autoComplete:"off"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{label:"CSS Selector",value:o.selector||".customer-info",onChange:h=>a("position","selector",h),autoComplete:"off",helpText:"Target element for inline placement"}),e.jsx(S,{label:"Placement",options:[{label:"After Element",value:"after"},{label:"Before Element",value:"before"},{label:"Inside (Append)",value:"append"},{label:"Inside (Prepend)",value:"prepend"}],value:o.placement||"after",onChange:h=>a("position","placement",h)})]})]})},M=()=>{const o=x.styling||{};return e.jsxs(g,{gap:"400",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Styling"}),e.jsxs(y,{gap:"400",wrap:!0,children:[e.jsx(m,{minWidth:"200px",children:e.jsx(z,{label:"Background Color",value:o.background_color||"#000000",onChange:n=>a("styling","background_color",n),colorType:"background"})}),e.jsx(m,{minWidth:"200px",children:e.jsx(z,{label:"Text Color",value:o.text_color||"#ffffff",onChange:n=>a("styling","text_color",n),colorType:"text"})})]}),(t.widget_type==="rewards_launcher"||t.widget_type==="referral_prompt")&&e.jsx(m,{minWidth:"200px",children:e.jsx(z,{label:t.widget_type==="rewards_launcher"?"Icon Color":"Accent Color",value:t.widget_type==="rewards_launcher"?o.icon_color||"#ffffff":o.accent_color||"#e85d27",onChange:n=>a("styling",t.widget_type==="rewards_launcher"?"icon_color":"accent_color",n),colorType:"primary"})}),e.jsxs(N.Group,{children:[e.jsx(b,{label:"Border Radius (px)",type:"number",value:String(o.border_radius||12),onChange:n=>a("styling","border_radius",parseInt(n)),autoComplete:"off"}),t.widget_type!=="rewards_launcher"&&e.jsx(b,{label:"Font Size (px)",type:"number",value:String(o.font_size||14),onChange:n=>a("styling","font_size",parseInt(n)),autoComplete:"off"}),t.widget_type==="rewards_launcher"&&e.jsx(b,{label:"Button Size (px)",type:"number",value:String(o.size||56),onChange:n=>a("styling","size",parseInt(n)),autoComplete:"off"})]}),t.widget_type==="tier_badge"&&e.jsx(S,{label:"Badge Style",options:he,value:o.badge_style||"pill",onChange:n=>a("styling","badge_style",n)}),e.jsx(p,{label:"Show Shadow",checked:o.shadow!==!1,onChange:n=>a("styling","shadow",n)})]})},E=()=>{const o=x.content||{};switch(t.widget_type){case"points_balance":return e.jsxs(g,{gap:"400",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Content"}),e.jsx(p,{label:"Show Icon",checked:o.show_icon!==!1,onChange:n=>a("content","show_icon",n)}),e.jsx(p,{label:"Show Label",checked:o.show_label!==!1,onChange:n=>a("content","show_label",n)}),e.jsx(b,{label:"Label Text",value:o.label_text||"Your Points",onChange:n=>a("content","label_text",n),autoComplete:"off"}),e.jsx(p,{label:"Show Tier Indicator",checked:o.show_tier_indicator!==!1,onChange:n=>a("content","show_tier_indicator",n)})]});case"tier_badge":return e.jsxs(g,{gap:"400",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Content"}),e.jsx(p,{label:"Show Tier Name",checked:o.show_tier_name!==!1,onChange:n=>a("content","show_tier_name",n)}),e.jsx(p,{label:"Show Tier Icon",checked:o.show_tier_icon!==!1,onChange:n=>a("content","show_tier_icon",n)}),e.jsx(p,{label:"Show Progress Bar",checked:o.show_progress_bar===!0,onChange:n=>a("content","show_progress_bar",n)})]});case"rewards_launcher":return e.jsxs(g,{gap:"400",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Content"}),e.jsx(S,{label:"Icon",options:ge,value:o.icon||"gift",onChange:n=>a("content","icon",n)}),e.jsx(b,{label:"Tooltip Text",value:o.tooltip_text||"View Rewards",onChange:n=>a("content","tooltip_text",n),autoComplete:"off"}),e.jsx(p,{label:"Show Notification Badge",checked:o.show_notification_badge!==!1,onChange:n=>a("content","show_notification_badge",n),helpText:"Shows a badge when there are available rewards"})]});case"referral_prompt":return e.jsxs(g,{gap:"400",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Content"}),e.jsx(b,{label:"Title",value:o.title||"Share & Earn!",onChange:n=>a("content","title",n),autoComplete:"off"}),e.jsx(b,{label:"Description",value:o.description||"Refer a friend and you both get rewarded",onChange:n=>a("content","description",n),autoComplete:"off",multiline:2}),e.jsx(b,{label:"CTA Button Text",value:o.cta_text||"Get Your Link",onChange:n=>a("content","cta_text",n),autoComplete:"off"}),e.jsx(p,{label:"Show Reward Amount",checked:o.show_reward_amount!==!1,onChange:n=>a("content","show_reward_amount",n)})]});default:return null}},A=()=>{const o=x.behavior||{};return e.jsxs(g,{gap:"400",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Behavior"}),e.jsx(p,{label:"Show on Mobile",checked:o.show_on_mobile!==!1,onChange:n=>a("behavior","show_on_mobile",n)}),t.widget_type==="points_balance"&&e.jsx(p,{label:"Animate on Update",checked:o.animate_on_update!==!1,onChange:n=>a("behavior","animate_on_update",n)}),t.widget_type==="rewards_launcher"&&e.jsx(S,{label:"Panel Position",options:[{label:"Right",value:"right"},{label:"Left",value:"left"},{label:"Center",value:"center"}],value:o.panel_position||"right",onChange:n=>a("behavior","panel_position",n)}),t.widget_type==="referral_prompt"&&e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"Trigger",options:ue,value:o.trigger||"scroll",onChange:n=>a("behavior","trigger",n)}),e.jsx(b,{label:o.trigger==="scroll"?"Scroll Percentage":o.trigger==="delay"?"Delay (seconds)":"Trigger Value",type:"number",value:String(o.trigger_value||50),onChange:n=>a("behavior","trigger_value",parseInt(n)),autoComplete:"off"}),e.jsx(p,{label:"Show Once Per Session",checked:o.show_once_per_session!==!1,onChange:n=>a("behavior","show_once_per_session",n)}),e.jsx(p,{label:"Dismissible",checked:o.dismissible!==!1,onChange:n=>a("behavior","dismissible",n)})]})]})};return e.jsx(G,{open:c,onClose:u,title:`Configure ${i.name}`,primaryAction:{content:"Save",onAction:k,loading:j},secondaryActions:[{content:"Reset to Defaults",onAction:d,icon:ie},{content:"Cancel",onAction:u}],size:"large",children:e.jsx(G.Section,{children:e.jsxs(g,{gap:"600",children:[e.jsx(T,{children:e.jsxs(g,{gap:"200",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Preview"}),e.jsx(m,{padding:"400",background:"bg-surface-secondary",borderRadius:"200",children:e.jsx(y,{align:"center",children:e.jsx($,{widget:{...t,config:x},metadata:i})})})]})}),I(),e.jsx(L,{}),M(),e.jsx(L,{}),E(),e.jsx(L,{}),A()]})})})}function Ie({shop:t}){const[i,c]=C.useState(null),[u,r]=C.useState(null),d=U(),{data:j,isLoading:x,error:w}=Y({queryKey:["widgets",t],queryFn:()=>pe(t),enabled:!!t}),_=O({mutationFn:({type:s,enabled:f})=>xe(t,s,f),onMutate:({type:s})=>r(s),onSettled:()=>r(null),onSuccess:()=>{d.invalidateQueries({queryKey:["widgets",t]})}}),v=O({mutationFn:({type:s,config:f})=>be(t,s,{config:f}),onSuccess:()=>{d.invalidateQueries({queryKey:["widgets",t]}),c(null)}}),a=O({mutationFn:s=>fe(t,s),onSuccess:()=>{d.invalidateQueries({queryKey:["widgets",t]})}}),k=j?.widgets||[],I=new Map(k.map(s=>[s.widget_type,s])),M=(s,f)=>{_.mutate({type:s,enabled:f})},E=(s,f)=>{v.mutate({type:s,config:f})},A=s=>{a.mutate(s)},o=i?I.get(i):null,n=i?D[i]:null,h=k.filter(s=>s.is_enabled).length;return x?e.jsx(F,{title:"Widgets",children:e.jsx(T,{children:e.jsxs(g,{gap:"400",inlineAlign:"center",children:[e.jsx(K,{accessibilityLabel:"Loading widgets",size:"large"}),e.jsx(l,{as:"p",children:"Loading widgets..."})]})})}):w?e.jsx(F,{title:"Widgets",children:e.jsx(q,{tone:"critical",children:"Failed to load widgets. Please try again."})}):e.jsxs(F,{title:"Widgets",subtitle:"Configure customer-facing widgets for your store",primaryAction:{content:"View Store",icon:ne,url:`https://${t}`,external:!0},children:[e.jsxs(P,{children:[e.jsx(P.Section,{children:e.jsx(q,{tone:"info",children:e.jsxs(l,{as:"p",children:["Widgets appear on your storefront to engage customers. You have"," ",e.jsx(l,{as:"span",fontWeight:"bold",children:h})," of"," ",e.jsx(l,{as:"span",fontWeight:"bold",children:Object.keys(D).length})," ","widgets enabled."]})})}),e.jsx(P.Section,{children:e.jsx(g,{gap:"400",children:Object.values(D).map(s=>{const f=I.get(s.type);return f?e.jsx(_e,{widget:f,metadata:s,onToggle:V=>M(s.type,V),onConfigure:()=>c(s.type),isToggling:u===s.type},s.type):null})})}),e.jsxs(P.Section,{variant:"oneThird",children:[e.jsx(T,{children:e.jsxs(g,{gap:"300",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Tips"}),e.jsxs(g,{gap:"200",children:[e.jsx(l,{as:"p",variant:"bodySm",children:"Enable the Points Balance widget to show customers their loyalty status."}),e.jsx(l,{as:"p",variant:"bodySm",children:"The Rewards Launcher gives quick access to your rewards program."}),e.jsx(l,{as:"p",variant:"bodySm",children:"Use the Referral Prompt to encourage word-of-mouth marketing."}),e.jsx(l,{as:"p",variant:"bodySm",children:"Match widget colors to your store theme for a cohesive look."})]})]})}),e.jsx(T,{children:e.jsxs(g,{gap:"300",children:[e.jsx(l,{as:"h3",variant:"headingMd",children:"Need Help?"}),e.jsx(l,{as:"p",variant:"bodySm",children:"Check our documentation for detailed widget setup guides."}),e.jsx(W,{url:"/app/settings",fullWidth:!0,children:"Go to Settings"})]})})]})]}),o&&n&&e.jsx(je,{widget:o,metadata:n,open:!!i,onClose:()=>c(null),onSave:s=>E(i,s),onReset:()=>A(i),isSaving:v.isPending})]})}export{Ie as EmbeddedWidgets,Ie as default};
