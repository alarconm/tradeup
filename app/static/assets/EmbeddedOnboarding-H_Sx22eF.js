import{b as M,u as E,c as S,j as e}from"./vendor-query-Bq4hz6H9.js";import{u as K,r as k}from"./vendor-router-CdtyvhQv.js";import{a as h,g}from"./index-CHD2jXUp.js";import{P as m,B as f,b as v,h as a,l as w,a as r,T as t,L as u,C as o,o as Q,t as C,c as d,u as U}from"./vendor-polaris-CV39Dq-f.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";async function W(n){const i=await h(`${g()}/onboarding/status`,n);if(!i.ok)throw new Error("Failed to fetch onboarding status");return i.json()}async function G(n){const i=await h(`${g()}/onboarding/templates`,n);if(!i.ok)throw new Error("Failed to fetch templates");return i.json()}async function R(n){const i=await h(`${g()}/onboarding/store-credit-check`,n);if(!i.ok)throw new Error("Failed to check store credit");return i.json()}async function Y(n,i){if(!(await h(`${g()}/onboarding/templates/${i}/apply`,n,{method:"POST"})).ok)throw new Error("Failed to apply template")}async function D(n){if(!(await h(`${g()}/onboarding/complete`,n,{method:"POST"})).ok)throw new Error("Failed to complete onboarding")}async function I(n){if(!(await h(`${g()}/onboarding/skip`,n,{method:"POST"})).ok)throw new Error("Failed to skip onboarding")}function ne({shop:n}){const i=K(),y=M(),[p,F]=k.useState(null),[c,P]=k.useState(null),{data:x,isLoading:z,error:$}=E({queryKey:["onboarding-status",n],queryFn:()=>W(n),enabled:!!n}),{data:O,isLoading:q}=E({queryKey:["onboarding-templates",n],queryFn:()=>G(n),enabled:!!n}),b=S({mutationFn:()=>R(n),onSuccess:s=>{P(s),s.enabled&&y.invalidateQueries({queryKey:["onboarding-status"]})}}),L=S({mutationFn:s=>Y(n,s),onSuccess:()=>{y.invalidateQueries({queryKey:["onboarding-status"]})}}),T=S({mutationFn:()=>D(n),onSuccess:()=>{i("/app/dashboard")}}),A=S({mutationFn:()=>I(n),onSuccess:()=>{i("/app/dashboard")}});if(!n)return e.jsx(m,{title:"Setup Wizard",children:e.jsx(f,{tone:"warning",children:e.jsx("p",{children:"No shop connected. Please install the app from the Shopify App Store."})})});if(z)return e.jsx(m,{title:"Setup Wizard",children:e.jsx(v,{padding:"1600",children:e.jsx(a,{align:"center",children:e.jsx(w,{size:"large"})})})});if($)return e.jsx(m,{title:"Setup Wizard",children:e.jsx(f,{tone:"critical",children:e.jsx("p",{children:"Failed to load setup status. Please try refreshing the page."})})});if(k.useEffect(()=>{x?.setup_complete&&i("/app/dashboard",{replace:!0})},[x?.setup_complete,i]),x?.setup_complete)return e.jsx(m,{title:"Setup Complete",children:e.jsx(v,{padding:"1600",children:e.jsxs(r,{gap:"400",inlineAlign:"center",children:[e.jsx(w,{size:"large"}),e.jsx(t,{as:"p",tone:"subdued",children:"Redirecting to dashboard..."})]})})});const l=x?.current_step||1,_=(l-1)/3*100;return e.jsx(m,{title:"Welcome to TradeUp!",subtitle:"Let's get your loyalty program set up in just a few steps",backAction:{content:"Dashboard",onAction:()=>i("/app/dashboard")},children:e.jsxs(u,{children:[e.jsx(u.Section,{children:e.jsx(o,{children:e.jsxs(r,{gap:"400",children:[e.jsxs(a,{align:"space-between",children:[e.jsx(t,{as:"span",variant:"bodySm",tone:"subdued",children:"Setup Progress"}),e.jsxs(t,{as:"span",variant:"bodySm",tone:"subdued",children:[l," of 4 steps"]})]}),e.jsx(Q,{progress:_,size:"small",tone:"primary"}),e.jsx(a,{gap:"200",wrap:!0,children:x?.steps.map(s=>e.jsx(C,{tone:s.status==="complete"?"success":s.id===l?"info":void 0,children:`${s.status==="complete"?"âœ“":s.id} ${s.name}`},s.id))})]})})}),l===1&&e.jsx(u.Section,{children:e.jsx(o,{children:e.jsxs(r,{gap:"400",inlineAlign:"center",children:[e.jsx("div",{style:{fontSize:"48px"},children:"ðŸŽ‰"}),e.jsx(t,{as:"h2",variant:"headingLg",children:"TradeUp is Installed!"}),e.jsx(t,{as:"p",tone:"subdued",alignment:"center",children:"Great! TradeUp is connected to your store. Let's get your loyalty program set up in just a few quick steps."}),e.jsx(d,{variant:"primary",onClick:()=>{y.invalidateQueries({queryKey:["onboarding-status"]})},children:"Let's Get Started"})]})})}),l===2&&e.jsx(u.Section,{children:e.jsx(o,{children:e.jsxs(r,{gap:"400",children:[e.jsx(t,{as:"h2",variant:"headingLg",children:"Enable Shopify Store Credit"}),e.jsx(t,{as:"p",tone:"subdued",children:"TradeUp uses Shopify's native store credit feature to reward your customers. This needs to be enabled in your Shopify settings."}),c?c.enabled?e.jsx(f,{tone:"success",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Store credit is enabled!"})," ",c.message]})}):e.jsxs(r,{gap:"400",children:[e.jsxs(f,{tone:"warning",children:[e.jsx("p",{children:e.jsx("strong",{children:"Store credit needs to be enabled"})}),e.jsx("p",{children:c.message}),c.instructions&&e.jsx("ol",{style:{margin:"8px 0",paddingLeft:"20px"},children:c.instructions.map((s,j)=>e.jsx("li",{children:s},j))})]}),e.jsxs(a,{gap:"200",children:[c.settings_url&&e.jsx(d,{variant:"secondary",url:c.settings_url,external:!0,children:"Open Shopify Settings"}),e.jsx(d,{loading:b.isPending,onClick:()=>b.mutate(),children:"Check Again"})]})]}):e.jsx(d,{variant:"primary",loading:b.isPending,onClick:()=>b.mutate(),children:"Check Store Credit Status"})]})})}),l===3&&e.jsx(u.Section,{children:e.jsx(o,{children:e.jsxs(r,{gap:"400",children:[e.jsx(t,{as:"h2",variant:"headingLg",children:"Choose Your Tier Structure"}),e.jsx(t,{as:"p",tone:"subdued",children:"Select a pre-built template that matches your business type. You can customize these later in Settings."}),q?e.jsx(v,{padding:"400",children:e.jsx(a,{align:"center",children:e.jsx(w,{size:"small"})})}):e.jsx(a,{gap:"400",wrap:!0,children:O?.templates.map(s=>e.jsx(o,{background:p===s.key?"bg-surface-secondary":void 0,children:e.jsxs(r,{gap:"300",children:[e.jsxs(a,{align:"space-between",blockAlign:"center",children:[e.jsx(t,{as:"h3",variant:"headingMd",children:s.name}),e.jsx(C,{children:`${s.tier_count} tiers`})]}),e.jsx(t,{as:"p",variant:"bodySm",tone:"subdued",children:s.description}),e.jsx(r,{gap:"100",children:s.tiers.map((j,B)=>e.jsxs(a,{gap:"200",blockAlign:"center",children:[e.jsx(t,{as:"span",children:j.icon}),e.jsx(t,{as:"span",variant:"bodySm",children:j.name}),e.jsx(C,{tone:"info",children:`${j.trade_in_rate}%`})]},B))}),e.jsx(d,{variant:p===s.key?"primary":"secondary",onClick:()=>F(s.key),fullWidth:!0,children:p===s.key?"Selected":"Select"})]})},s.key))}),e.jsxs(a,{gap:"200",children:[e.jsx(d,{variant:"primary",loading:L.isPending,disabled:!p,onClick:()=>p&&L.mutate(p),children:"Apply Template"}),e.jsx(d,{variant:"plain",onClick:()=>i("/app/tiers"),children:"Or create custom tiers"})]})]})})}),l===4&&e.jsx(u.Section,{children:e.jsx(o,{children:e.jsxs(r,{gap:"400",inlineAlign:"center",children:[e.jsx("div",{style:{fontSize:"48px"},children:"ðŸš€"}),e.jsx(t,{as:"h2",variant:"headingLg",children:"You're All Set!"}),e.jsx(t,{as:"p",tone:"subdued",alignment:"center",children:"Your loyalty program is ready to start accepting members. Customers will automatically be enrolled when they make a purchase."}),e.jsxs(U,{columns:{xs:1,sm:3},gap:"400",children:[e.jsx(o,{children:e.jsxs(r,{gap:"100",inlineAlign:"center",children:[e.jsx(t,{as:"span",variant:"bodySm",tone:"subdued",children:"Tiers Created"}),e.jsx(t,{as:"span",variant:"headingLg",children:"3"})]})}),e.jsx(o,{children:e.jsxs(r,{gap:"100",inlineAlign:"center",children:[e.jsx(t,{as:"span",variant:"bodySm",tone:"subdued",children:"Store Credit"}),e.jsx(t,{as:"span",variant:"headingLg",children:"Enabled"})]})}),e.jsx(o,{children:e.jsxs(r,{gap:"100",inlineAlign:"center",children:[e.jsx(t,{as:"span",variant:"bodySm",tone:"subdued",children:"Auto-Enrollment"}),e.jsx(t,{as:"span",variant:"headingLg",children:"On"})]})})]}),e.jsx(d,{variant:"primary",size:"large",loading:T.isPending,onClick:()=>T.mutate(),children:"Go to Dashboard"})]})})}),e.jsx(u.Section,{children:e.jsx(a,{align:"center",children:e.jsx(d,{variant:"plain",loading:A.isPending,onClick:()=>A.mutate(),children:"Skip setup and configure manually"})})})]})})}export{ne as EmbeddedOnboarding};
