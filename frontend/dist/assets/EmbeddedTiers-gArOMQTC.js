import{b as Q,u as W,c as w,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as l}from"./vendor-router-CdtyvhQv.js";import{a as j,g as v}from"./index-D10Yqe92.js";import{P as F,B as M,b as K,h as $,l as z,v as H,L as y,C as D,R as U,w as G,a as p,T as a,t as B,x as J,E as V,M as g,e as I,g as u,y as q,z as Y,c as X,m as Z,n as ee,q as te}from"./vendor-polaris-1WqYVNpP.js";import{T as ne}from"./vendor-appbridge-DL6abzKC.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";async function ae(r){const i=await j(`${v()}/members/tiers`,r);if(!i.ok){const s=await i.json().catch(()=>({}));throw new Error(s.error||s.message||`Failed to fetch tiers (${i.status})`)}return(await i.json()).tiers||[]}async function re(r,i){const o=await j(`${v()}/members/tiers`,r,{method:"POST",body:JSON.stringify(i)});if(!o.ok){const s=await o.json().catch(()=>({}));throw new Error(s.error||s.message||`Failed to create tier (${o.status})`)}return o.json()}async function se(r,i,o){const s=await j(`${v()}/members/tiers/${i}`,r,{method:"PUT",body:JSON.stringify(o)});if(!s.ok){const d=await s.json().catch(()=>({}));throw new Error(d.error||d.message||`Failed to update tier (${s.status})`)}return s.json()}async function ie(r,i){const o=await j(`${v()}/members/tiers/${i}`,r,{method:"DELETE"});if(!o.ok){const s=await o.json();throw new Error(s.error||"Failed to delete tier")}}function me({shop:r}){const i=Q(),[o,s]=l.useState(!1),[d,S]=l.useState(null),[C,m]=l.useState(null),[x,b]=l.useState(!1),[E,h]=l.useState(null),[n,c]=l.useState({name:"",monthly_price:"0",yearly_price:"",bonus_rate:5,purchase_cashback_pct:0,monthly_credit_amount:"0",credit_expiration_days:"",discount_percent:"0",free_shipping_threshold:""}),{data:T,isLoading:L,error:N}=W({queryKey:["tiers",r],queryFn:()=>ae(r),enabled:!!r}),k=w({mutationFn:t=>re(r,t),onSuccess:()=>{h(null),i.invalidateQueries({queryKey:["tiers"]}),f()},onError:t=>{h(t.message||"Failed to create tier. Please try again.")}}),A=w({mutationFn:({id:t,tier:R})=>se(r,t,R),onSuccess:()=>{h(null),i.invalidateQueries({queryKey:["tiers"]}),f()},onError:t=>{h(t.message||"Failed to update tier. Please try again.")}}),P=w({mutationFn:t=>ie(r,t),onSuccess:()=>{h(null),i.invalidateQueries({queryKey:["tiers"]}),m(null)},onError:t=>{h(t.message||"Failed to delete tier. Please try again."),m(null)}}),_=l.useCallback(t=>{t?(S(t),c({name:t.name,monthly_price:String(t.monthly_price||0),yearly_price:t.yearly_price?String(t.yearly_price):"",bonus_rate:(t.bonus_rate||0)*100,purchase_cashback_pct:t.purchase_cashback_pct||0,monthly_credit_amount:String(t.monthly_credit_amount||0),credit_expiration_days:t.credit_expiration_days?String(t.credit_expiration_days):"",discount_percent:String(t.benefits?.discount_percent||0),free_shipping_threshold:t.benefits?.free_shipping_threshold?String(t.benefits.free_shipping_threshold):""}),b((t.purchase_cashback_pct||0)>0||(t.monthly_credit_amount||0)>0||!!t.credit_expiration_days||(t.benefits?.discount_percent||0)>0||!!t.benefits?.free_shipping_threshold)):(S(null),c({name:"",monthly_price:"0",yearly_price:"",bonus_rate:5,purchase_cashback_pct:0,monthly_credit_amount:"0",credit_expiration_days:"",discount_percent:"0",free_shipping_threshold:""}),b(!1)),s(!0)},[]),f=l.useCallback(()=>{s(!1),S(null),b(!1),h(null)},[]),O=l.useCallback(()=>{const t={name:n.name,monthly_price:parseFloat(n.monthly_price)||0,yearly_price:n.yearly_price?parseFloat(n.yearly_price):null,bonus_rate:n.bonus_rate/100,purchase_cashback_pct:n.purchase_cashback_pct||0,monthly_credit_amount:parseFloat(n.monthly_credit_amount)||0,credit_expiration_days:n.credit_expiration_days?parseInt(n.credit_expiration_days):null,benefits:{discount_percent:parseFloat(n.discount_percent)||0,free_shipping_threshold:n.free_shipping_threshold?parseFloat(n.free_shipping_threshold):void 0}};d?A.mutate({id:d.id,tier:t}):k.mutate(t)},[n,d,k,A]);return r?L?e.jsx(F,{title:"Membership Tiers",children:e.jsx(K,{padding:"1600",children:e.jsx($,{align:"center",children:e.jsx(z,{size:"large"})})})}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{title:"Membership Tiers",children:e.jsx("button",{variant:"primary",onClick:()=>_(),children:"Add tier"})}),e.jsxs(F,{title:"Membership Tiers",subtitle:"Configure tier benefits, pricing, and trade-in bonuses",primaryAction:{content:"Add Tier",icon:H,onAction:()=>_()},children:[e.jsxs(y,{children:[N&&e.jsx(y.Section,{children:e.jsx(M,{tone:"critical",children:e.jsx("p",{children:"Failed to load tiers. Please try refreshing the page."})})}),E&&e.jsx(y.Section,{children:e.jsx(M,{tone:"critical",onDismiss:()=>h(null),children:e.jsx("p",{children:E})})}),e.jsx(y.Section,{children:e.jsx(D,{padding:"0",children:T&&T.length>0?e.jsx(U,{resourceName:{singular:"tier",plural:"tiers"},items:T.filter(t=>t&&t.id!=null),renderItem:t=>e.jsx(G,{id:String(t.id),accessibilityLabel:t.name||"Tier",onClick:()=>_(t),media:e.jsx(J,{customer:!0,size:"md",name:t.name||"Tier",initials:(t.name||"T").charAt(0),source:void 0}),shortcutActions:[{content:"Edit",onAction:()=>_(t)},{content:"Delete",onAction:()=>m(t.id)}],children:e.jsxs(p,{gap:"200",children:[e.jsxs($,{gap:"200",blockAlign:"center",wrap:!0,children:[e.jsx(a,{as:"h3",variant:"bodyMd",fontWeight:"bold",children:t.name}),!t.is_active&&e.jsx(B,{tone:"warning",children:"Inactive"}),e.jsx(B,{tone:"success",children:`${((t.bonus_rate||0)*100).toFixed(0)}% trade-in bonus`})]}),e.jsxs($,{gap:"300",wrap:!0,children:[e.jsxs(a,{as:"span",variant:"bodySm",tone:"subdued",children:["$",(t.monthly_price||0).toFixed(2),"/mo"]}),e.jsxs(a,{as:"span",variant:"bodySm",tone:"subdued",children:["Bonus: ",((t.bonus_rate||0)*100).toFixed(0),"%"]}),(t.purchase_cashback_pct||0)>0&&e.jsxs(a,{as:"span",variant:"bodySm",tone:"success",children:["Cashback: ",t.purchase_cashback_pct,"%"]}),(t.monthly_credit_amount||0)>0&&e.jsxs(a,{as:"span",variant:"bodySm",tone:"subdued",children:["Monthly: $",t.monthly_credit_amount]})]})]})})}):e.jsx(V,{heading:"Create your first membership tier",action:{content:"Add Tier",onAction:()=>_()},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Membership tiers define the trade-in bonuses and benefits customers receive. Higher tiers can offer better rates to reward loyal customers."})})})}),e.jsx(y.Section,{variant:"oneThird",children:e.jsx(D,{children:e.jsxs(p,{gap:"400",children:[e.jsx(a,{as:"h3",variant:"headingMd",children:"How Tiers Work"}),e.jsxs(p,{gap:"200",children:[e.jsxs(a,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Trade-in Bonus:"})," Extra credit given on top of trade-in value. A 10% bonus on a $100 trade-in = $10 extra credit."]}),e.jsxs(a,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Purchase Cashback:"})," Store credit earned on every purchase. 2% cashback on a $50 order = $1 credit."]}),e.jsxs(a,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Monthly Credit:"})," Auto-issued store credit on the 1st of each month for active members."]})]})]})})})]}),e.jsx(g,{open:o,onClose:f,title:d?"Edit Tier":"Create Tier",primaryAction:{content:d?"Save":"Create",onAction:O,loading:k.isPending||A.isPending,disabled:!n.name.trim()},secondaryActions:[{content:"Cancel",onAction:f}],children:e.jsx(g.Section,{children:e.jsxs(I,{children:[e.jsx(u,{label:"Tier Name",value:n.name,onChange:t=>c({...n,name:t}),placeholder:"e.g., Gold, Platinum, VIP",autoComplete:"off",helpText:"Choose a memorable name for this tier"}),e.jsxs(I.Group,{children:[e.jsx(u,{label:"Monthly Price",type:"number",value:n.monthly_price,onChange:t=>c({...n,monthly_price:t}),prefix:"$",helpText:"Set to $0 for free tiers",autoComplete:"off"}),e.jsx(u,{label:"Yearly Price (optional)",type:"number",value:n.yearly_price,onChange:t=>c({...n,yearly_price:t}),prefix:"$",placeholder:"Optional",helpText:"Discounted annual option",autoComplete:"off"})]}),e.jsxs(p,{gap:"200",children:[e.jsx(a,{as:"p",variant:"bodyMd",fontWeight:"semibold",children:"Trade-in Bonus Rate"}),e.jsx(q,{label:"",value:n.bonus_rate,onChange:t=>c({...n,bonus_rate:t}),min:0,max:30,step:1,output:!0,suffix:e.jsxs(a,{as:"span",variant:"bodyMd",children:[n.bonus_rate,"%"]})}),e.jsx(a,{as:"p",variant:"bodySm",tone:"subdued",children:"Extra credit given on top of trade-in value (e.g., 10% bonus on $100 trade = $10 extra)"})]}),e.jsx(Y,{}),e.jsx(X,{onClick:()=>b(!x),icon:x?Z:ee,variant:"plain",fullWidth:!0,textAlign:"left",children:x?"Hide Advanced Settings":"Show Advanced Settings"}),e.jsx(te,{open:x,id:"advanced-settings",transition:{duration:"200ms",timingFunction:"ease-in-out"},children:e.jsxs(p,{gap:"400",children:[e.jsxs(p,{gap:"200",children:[e.jsx(a,{as:"p",variant:"bodyMd",fontWeight:"semibold",children:"Purchase Cashback %"}),e.jsx(q,{label:"",value:n.purchase_cashback_pct,onChange:t=>c({...n,purchase_cashback_pct:t}),min:0,max:10,step:.5,output:!0,suffix:e.jsxs(a,{as:"span",variant:"bodyMd",children:[n.purchase_cashback_pct,"%"]})}),e.jsx(a,{as:"p",variant:"bodySm",tone:"subdued",children:"Store credit earned on every purchase (e.g., 2% = $2 back per $100)"})]}),e.jsx(u,{label:"Recurring Monthly Credit",type:"number",value:n.monthly_credit_amount,onChange:t=>c({...n,monthly_credit_amount:t}),prefix:"$",helpText:"Auto-issued store credit on 1st of each month",autoComplete:"off"}),e.jsx(u,{label:"Credit Expiration (Days)",type:"number",value:n.credit_expiration_days,onChange:t=>c({...n,credit_expiration_days:t}),placeholder:"Never expires",helpText:"Days until issued credit expires (leave blank for no expiration)",autoComplete:"off"}),e.jsx(u,{label:"Store Discount (%)",type:"number",value:n.discount_percent,onChange:t=>c({...n,discount_percent:t}),suffix:"%",helpText:"Automatic discount on all purchases for tier members",autoComplete:"off"}),e.jsx(u,{label:"Free Shipping Threshold",type:"number",value:n.free_shipping_threshold,onChange:t=>c({...n,free_shipping_threshold:t}),prefix:"$",placeholder:"No free shipping",helpText:"Order minimum for free shipping (0 = always free, blank = no benefit)",autoComplete:"off"})]})})]})})}),e.jsx(g,{open:C!==null,onClose:()=>m(null),title:"Delete Tier",primaryAction:{content:"Delete",destructive:!0,onAction:()=>C&&P.mutate(C),loading:P.isPending},secondaryActions:[{content:"Cancel",onAction:()=>m(null)}],children:e.jsx(g.Section,{children:e.jsx(a,{as:"p",children:"Are you sure you want to delete this tier? This action cannot be undone. Members currently in this tier will need to be reassigned."})})})]})]}):e.jsx(F,{title:"Membership Tiers",children:e.jsx(M,{tone:"warning",children:e.jsx("p",{children:"No shop connected. Please install the app from the Shopify App Store."})})})}export{me as EmbeddedTiers};
