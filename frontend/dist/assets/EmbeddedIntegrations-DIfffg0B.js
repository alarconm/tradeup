import{b as U,u as J,c as M,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as p}from"./vendor-router-CdtyvhQv.js";import{a as f,g as b}from"./index-r9c0LRG1.js";import{P as F,C as x,a,l as N,T as g,L as v,B as z,a9 as G,c as h,M as A,e as _,g as P,h as E,t as H}from"./vendor-polaris-1WqYVNpP.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";async function V(t){const i=await f(`${b()}/integrations/status`,t);if(!i.ok)throw new Error("Failed to fetch integrations");return i.json()}function ie({shop:t}){const[i,I]=p.useState(0),[l,u]=p.useState(null),[S,m]=p.useState(""),[y,j]=p.useState(""),w=U(),{data:o,isLoading:K,error:B}=J({queryKey:["integrations",t],queryFn:()=>V(t),enabled:!!t}),C=n=>({klaviyo:"klaviyo",postscript:"sms/postscript",attentive:"sms/attentive",gorgias:"gorgias",judgeme:"judgeme",recharge:"recharge"})[n]||n,T=M({mutationFn:async({integration:n,credentials:s})=>{const c=C(n),d=await f(`${b()}/integrations/${c}/connect`,t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!d.ok)throw new Error("Connection failed");return d.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["integrations",t]}),u(null),m(""),j("")}}),k=M({mutationFn:async n=>{const s=C(n),c=await f(`${b()}/integrations/${s}/disconnect`,t,{method:"POST"});if(!c.ok)throw new Error("Disconnect failed");return c.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["integrations",t]})}}),$=[{id:"email",content:"Email Marketing"},{id:"sms",content:"SMS Marketing"},{id:"support",content:"Customer Service"},{id:"reviews",content:"Reviews"},{id:"subscriptions",content:"Subscriptions"}],r=(n,s,c,d)=>e.jsx(x,{children:e.jsxs(a,{gap:"300",children:[e.jsxs(E,{align:"space-between",children:[e.jsx(g,{as:"h3",variant:"headingMd",children:n}),e.jsx(H,{tone:d?.enabled?"success":void 0,children:d?.enabled?"Connected":"Not Connected"})]}),e.jsx(g,{as:"p",variant:"bodyMd",tone:"subdued",children:c}),e.jsx(E,{gap:"200",children:d?.enabled?e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:()=>u(s),children:"Configure"}),e.jsx(h,{tone:"critical",onClick:()=>k.mutate(s),loading:k.isPending,children:"Disconnect"})]}):e.jsx(h,{variant:"primary",onClick:()=>u(s),children:"Connect"})})]})},s),q=()=>e.jsx(a,{gap:"400",children:r("Klaviyo","klaviyo","Sync member data and trigger email flows on loyalty events like tier upgrades and points earned.",o?.integrations.klaviyo)}),D=()=>e.jsxs(a,{gap:"400",children:[r("Postscript","postscript","Send SMS notifications for loyalty events and sync subscriber data.",o?.integrations.postscript),r("Attentive","attentive","Trigger Attentive journeys on loyalty events and sync customer attributes.",o?.integrations.attentive)]}),L=()=>e.jsx(a,{gap:"400",children:r("Gorgias","gorgias","Display loyalty data in support tickets and auto-enrich customer profiles.",o?.integrations.gorgias)}),O=()=>e.jsx(a,{gap:"400",children:r("Judge.me","judgeme","Award points when customers leave product reviews. Bonus points for photo and video reviews.",o?.integrations.judgeme)}),Q=()=>e.jsx(a,{gap:"400",children:r("Recharge","recharge","Track subscription revenue for tier eligibility and award points on recurring payments.",o?.integrations.recharge)}),R=()=>{if(!l)return;const n={api_key:S};y&&(n.domain=y),T.mutate({integration:l,credentials:n})};return K?e.jsx(F,{title:"Integrations",children:e.jsx(x,{children:e.jsxs(a,{gap:"200",inlineAlign:"center",children:[e.jsx(N,{size:"large"}),e.jsx(g,{as:"p",children:"Loading integrations..."})]})})}):e.jsxs(F,{title:"Integrations",subtitle:"Connect your favorite apps to TradeUp",children:[e.jsxs(v,{children:[e.jsxs(v.Section,{children:[B&&e.jsx(z,{tone:"critical",children:"Failed to load integrations. Please try again."}),e.jsx(G,{tabs:$,selected:i,onSelect:I,children:e.jsxs("div",{style:{padding:"16px 0"},children:[i===0&&q(),i===1&&D(),i===2&&L(),i===3&&O(),i===4&&Q()]})})]}),e.jsx(v.Section,{variant:"oneThird",children:e.jsx(x,{children:e.jsxs(a,{gap:"300",children:[e.jsx(g,{as:"h3",variant:"headingMd",children:"Shopify Flow"}),e.jsx(g,{as:"p",variant:"bodyMd",tone:"subdued",children:"TradeUp automatically works with Shopify Flow. Use our triggers and actions in your automation workflows."}),e.jsx(h,{url:"https://admin.shopify.com/store/flow",external:!0,children:"Open Flow Editor"})]})})})]}),e.jsx(A,{open:!!l,onClose:()=>{u(null),m(""),j("")},title:`Connect ${l}`,primaryAction:{content:"Connect",onAction:R,loading:T.isPending},secondaryActions:[{content:"Cancel",onAction:()=>u(null)}],children:e.jsx(A.Section,{children:e.jsxs(_,{children:[e.jsx(P,{label:"API Key",value:S,onChange:m,autoComplete:"off",type:"password"}),l==="gorgias"&&e.jsx(P,{label:"Domain",value:y,onChange:j,placeholder:"yourstore.gorgias.com",autoComplete:"off"})]})})})]})}export{ie as EmbeddedIntegrations,ie as default};
