import{b as ue,u as $,c as w,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as y}from"./vendor-router-CdtyvhQv.js";import{a as m,g}from"./index-CG0F7Qqq.js";import{P as N,C as x,a as d,l as pe,T as i,h as v,I as B,p as z,t as E,c as b,L as D,a9 as he,E as U,D as J,a7 as me,r as ge,M as F,B as V,e as j,g as c,f as q}from"./vendor-polaris-1WqYVNpP.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";const I={name:"",description:"",icon:"trophy",color:"#e85d27",criteria_type:"first_purchase",criteria_value:"1",points_reward:"0",credit_reward:"0",is_secret:!1},L={name:"",description:"",milestone_type:"points_earned",threshold:"100",points_reward:"0",credit_reward:"0",celebration_message:""},W=[{label:"First Purchase",value:"first_purchase"},{label:"Trade-In Count",value:"trade_in_count"},{label:"Points Earned",value:"points_earned"},{label:"Referral Count",value:"referral_count"},{label:"Tier Reached",value:"tier_reached"},{label:"Streak Days",value:"streak_days"},{label:"Total Spent",value:"total_spent"},{label:"Member Anniversary",value:"member_anniversary"}],Y=[{label:"Points Earned",value:"points_earned"},{label:"Trade-Ins Completed",value:"trade_ins_completed"},{label:"Referrals Made",value:"referrals_made"},{label:"Total Spent",value:"total_spent"},{label:"Days as Member",value:"member_days"}],fe=[{label:"Trophy",value:"trophy"},{label:"Star",value:"star"},{label:"Medal",value:"medal"},{label:"Fire",value:"fire"},{label:"Heart",value:"heart"},{label:"Gift",value:"gift"},{label:"Crown",value:"crown"},{label:"Lightning",value:"lightning"}];async function ye(a){const o=await m(`${g()}/gamification/badges?include_inactive=true`,a);if(!o.ok)throw new Error("Failed to fetch badges");return o.json()}async function xe(a){const o=await m(`${g()}/gamification/milestones?include_inactive=true`,a);if(!o.ok)throw new Error("Failed to fetch milestones");return o.json()}async function je(a){const o=await m(`${g()}/gamification/stats`,a);if(!o.ok)throw new Error("Failed to fetch stats");return o.json()}async function ve(a){const o=await m(`${g()}/gamification/initialize`,a,{method:"POST"});if(!o.ok)throw new Error("Failed to initialize defaults");return o.json()}function Ee({shop:a}){const[o,H]=y.useState(0),[X,f]=y.useState(!1),[Z,_]=y.useState(!1),[r,l]=y.useState(I),[s,h]=y.useState(L),[C,M]=y.useState(null),[S,u]=y.useState(null),p=ue(),{data:ee,isLoading:te}=$({queryKey:["gamification-badges",a],queryFn:()=>ye(a),enabled:!!a}),{data:ae,isLoading:ie}=$({queryKey:["gamification-milestones",a],queryFn:()=>xe(a),enabled:!!a}),{data:ne}=$({queryKey:["gamification-stats",a],queryFn:()=>je(a),enabled:!!a}),K=w({mutationFn:async t=>{const n=await m(`${g()}/gamification/badges`,a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,description:t.description,icon:t.icon,color:t.color,criteria_type:t.criteria_type,criteria_value:parseInt(t.criteria_value),points_reward:parseInt(t.points_reward),credit_reward:parseFloat(t.credit_reward),is_secret:t.is_secret})});if(!n.ok)throw new Error("Failed to create badge");return n.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["gamification-badges",a]}),p.invalidateQueries({queryKey:["gamification-stats",a]}),f(!1),l(I),M(null)},onError:t=>u(t.message)}),R=w({mutationFn:async({id:t,badge:n})=>{const G=await m(`${g()}/gamification/badges/${t}`,a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n.name,description:n.description,icon:n.icon,color:n.color,criteria_type:n.criteria_type,criteria_value:parseInt(n.criteria_value),points_reward:parseInt(n.points_reward),credit_reward:parseFloat(n.credit_reward),is_secret:n.is_secret})});if(!G.ok)throw new Error("Failed to update badge");return G.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["gamification-badges",a]}),f(!1),l(I),M(null)},onError:t=>u(t.message)}),O=w({mutationFn:async t=>{const n=await m(`${g()}/gamification/badges/${t}`,a,{method:"DELETE"});if(!n.ok)throw new Error("Failed to delete badge");return n.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["gamification-badges",a]}),p.invalidateQueries({queryKey:["gamification-stats",a]})}}),Q=w({mutationFn:async t=>{const n=await m(`${g()}/gamification/milestones`,a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,description:t.description,milestone_type:t.milestone_type,threshold:parseInt(t.threshold),points_reward:parseInt(t.points_reward),credit_reward:parseFloat(t.credit_reward),celebration_message:t.celebration_message})});if(!n.ok)throw new Error("Failed to create milestone");return n.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["gamification-milestones",a]}),p.invalidateQueries({queryKey:["gamification-stats",a]}),_(!1),h(L)},onError:t=>u(t.message)}),k=w({mutationFn:()=>ve(a),onSuccess:()=>{p.invalidateQueries({queryKey:["gamification-badges",a]}),p.invalidateQueries({queryKey:["gamification-milestones",a]}),p.invalidateQueries({queryKey:["gamification-stats",a]})},onError:t=>u(t.message)}),re=t=>{M(t),l({name:t.name,description:t.description||"",icon:t.icon,color:t.color,criteria_type:t.criteria_type,criteria_value:String(t.criteria_value),points_reward:String(t.points_reward),credit_reward:String(t.credit_reward),is_secret:t.is_secret}),f(!0)},se=()=>{if(!r.name||!r.criteria_type){u("Please fill in all required fields");return}C?R.mutate({id:C.id,badge:r}):K.mutate(r)},oe=()=>{if(!s.name||!s.milestone_type||!s.threshold){u("Please fill in all required fields");return}Q.mutate(s)},T=ee?.badges||[],P=ae?.milestones||[],A=ne?.stats||{total_badges:0,total_milestones:0,total_badges_earned:0},le=[{id:"badges",content:"Badges",panelID:"badges-panel"},{id:"milestones",content:"Milestones",panelID:"milestones-panel"},{id:"overview",content:"Overview",panelID:"overview-panel"}];if(te||ie)return e.jsx(N,{title:"Gamification",children:e.jsx(x,{children:e.jsxs(d,{gap:"200",inlineAlign:"center",children:[e.jsx(pe,{size:"large"}),e.jsx(i,{as:"p",children:"Loading gamification data..."})]})})});const ce=T.map(t=>[e.jsxs(v,{gap:"200",blockAlign:"center",children:[e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:t.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"16px"},children:t.icon==="trophy"?e.jsx(B,{source:z}):(t.icon||"B").charAt(0).toUpperCase()}),e.jsx(i,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:t.name})]},t.id),t.description||"-",W.find(n=>n.value===t.criteria_type)?.label||t.criteria_type,`${t.criteria_value}`,t.points_reward>0?`${t.points_reward} pts`:"-",t.credit_reward>0?`$${t.credit_reward}`:"-",t.is_active?e.jsx(E,{tone:"success",children:"Active"}):e.jsx(E,{children:"Inactive"}),e.jsxs(v,{gap:"100",children:[e.jsx(b,{size:"slim",onClick:()=>re(t),children:"Edit"}),e.jsx(b,{size:"slim",tone:"critical",onClick:()=>O.mutate(t.id),loading:O.isPending,children:"Delete"})]},`actions-${t.id}`)]),de=P.map(t=>[t.name,t.description||"-",Y.find(n=>n.value===t.milestone_type)?.label||t.milestone_type,`${t.threshold}`,t.points_reward>0?`${t.points_reward} pts`:"-",t.credit_reward>0?`$${t.credit_reward}`:"-",t.is_active?e.jsx(E,{tone:"success",children:"Active"}):e.jsx(E,{children:"Inactive"})]);return e.jsxs(N,{title:"Gamification",subtitle:"Engage customers with badges, achievements, and milestones",children:[e.jsxs(D,{children:[e.jsx(D.Section,{children:e.jsx(x,{children:e.jsxs(he,{tabs:le,selected:o,onSelect:H,children:[o===0&&e.jsxs(d,{gap:"400",children:[e.jsxs(v,{align:"space-between",children:[e.jsxs(i,{as:"h3",variant:"headingMd",children:["Badges (",T.length,")"]}),e.jsxs(v,{gap:"200",children:[T.length===0&&e.jsx(b,{onClick:()=>k.mutate(),loading:k.isPending,children:"Load Default Badges"}),e.jsx(b,{variant:"primary",onClick:()=>f(!0),children:"Create Badge"})]})]}),T.length===0?e.jsx(U,{heading:"No badges created yet",action:{content:"Load Default Badges",onAction:()=>k.mutate()},secondaryAction:{content:"Create Custom Badge",onAction:()=>f(!0)},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx(i,{as:"p",children:"Start by loading our default badges or create your own custom achievements."})}):e.jsx(J,{columnContentTypes:["text","text","text","numeric","text","text","text","text"],headings:["Badge","Description","Criteria","Value","Points","Credit","Status","Actions"],rows:ce})]}),o===1&&e.jsxs(d,{gap:"400",children:[e.jsxs(v,{align:"space-between",children:[e.jsxs(i,{as:"h3",variant:"headingMd",children:["Milestones (",P.length,")"]}),e.jsx(b,{variant:"primary",onClick:()=>_(!0),children:"Create Milestone"})]}),P.length===0?e.jsx(U,{heading:"No milestones created yet",action:{content:"Create Milestone",onAction:()=>_(!0)},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx(i,{as:"p",children:"Create milestones to celebrate customer achievements like reaching 1000 points."})}):e.jsx(J,{columnContentTypes:["text","text","text","numeric","text","text","text"],headings:["Milestone","Description","Type","Threshold","Points","Credit","Status"],rows:de})]}),o===2&&e.jsxs(d,{gap:"400",children:[e.jsx(i,{as:"h3",variant:"headingMd",children:"Program Overview"}),e.jsxs(v,{gap:"400",wrap:!1,children:[e.jsx(x,{children:e.jsxs(d,{gap:"200",inlineAlign:"center",children:[e.jsx(B,{source:z}),e.jsx(i,{as:"p",variant:"headingLg",children:`${A.total_badges}`}),e.jsx(i,{as:"p",variant:"bodyMd",tone:"subdued",children:"Total Badges"})]})}),e.jsx(x,{children:e.jsxs(d,{gap:"200",inlineAlign:"center",children:[e.jsx(B,{source:me}),e.jsx(i,{as:"p",variant:"headingLg",children:`${A.total_milestones}`}),e.jsx(i,{as:"p",variant:"bodyMd",tone:"subdued",children:"Total Milestones"})]})}),e.jsx(x,{children:e.jsxs(d,{gap:"200",inlineAlign:"center",children:[e.jsx(B,{source:ge}),e.jsx(i,{as:"p",variant:"headingLg",children:`${A.total_badges_earned}`}),e.jsx(i,{as:"p",variant:"bodyMd",tone:"subdued",children:"Badges Earned"})]})})]})]})]})})}),e.jsxs(D.Section,{variant:"oneThird",children:[e.jsx(x,{children:e.jsxs(d,{gap:"300",children:[e.jsx(i,{as:"h3",variant:"headingMd",children:"How Gamification Works"}),e.jsx(i,{as:"p",variant:"bodyMd",tone:"subdued",children:"Gamification increases engagement by rewarding customers for their loyalty activities."}),e.jsxs(d,{gap:"200",children:[e.jsxs(i,{as:"p",variant:"bodyMd",children:[e.jsx("strong",{children:"Badges:"})," Award for specific achievements"]}),e.jsxs(i,{as:"p",variant:"bodyMd",children:[e.jsx("strong",{children:"Milestones:"})," Celebrate cumulative progress"]}),e.jsxs(i,{as:"p",variant:"bodyMd",children:[e.jsx("strong",{children:"Streaks:"})," Track consecutive activity"]})]})]})}),e.jsx(x,{children:e.jsxs(d,{gap:"300",children:[e.jsx(i,{as:"h3",variant:"headingMd",children:"Badge Ideas"}),e.jsxs(d,{gap:"100",children:[e.jsx(i,{as:"p",variant:"bodyMd",children:"First Purchase Champion"}),e.jsx(i,{as:"p",variant:"bodyMd",children:"Trade-In Master (50 trade-ins)"}),e.jsx(i,{as:"p",variant:"bodyMd",children:"Referral King (10 referrals)"}),e.jsx(i,{as:"p",variant:"bodyMd",children:"Loyalty Legend (1 year member)"}),e.jsx(i,{as:"p",variant:"bodyMd",children:"Streak Warrior (30 day streak)"})]})]})})]})]}),e.jsx(F,{open:X,onClose:()=>{f(!1),l(I),M(null),u(null)},title:C?"Edit Badge":"Create Badge",primaryAction:{content:C?"Update Badge":"Create Badge",onAction:se,loading:K.isPending||R.isPending},secondaryActions:[{content:"Cancel",onAction:()=>f(!1)}],children:e.jsxs(F.Section,{children:[S&&e.jsx(V,{tone:"critical",onDismiss:()=>u(null),children:S}),e.jsxs(j,{children:[e.jsx(c,{label:"Badge Name",value:r.name,onChange:t=>l({...r,name:t}),placeholder:"Trade-In Pro",autoComplete:"off"}),e.jsx(c,{label:"Description",value:r.description,onChange:t=>l({...r,description:t}),placeholder:"Awarded for completing 10 trade-ins",multiline:2,autoComplete:"off"}),e.jsxs(j.Group,{children:[e.jsx(q,{label:"Icon",options:fe,value:r.icon,onChange:t=>l({...r,icon:t})}),e.jsx(c,{label:"Color",value:r.color,onChange:t=>l({...r,color:t}),placeholder:"#e85d27",autoComplete:"off"})]}),e.jsxs(j.Group,{children:[e.jsx(q,{label:"Criteria Type",options:W,value:r.criteria_type,onChange:t=>l({...r,criteria_type:t})}),e.jsx(c,{label:"Criteria Value",type:"number",value:r.criteria_value,onChange:t=>l({...r,criteria_value:t}),helpText:"e.g., 10 for '10 trade-ins'",autoComplete:"off"})]}),e.jsxs(j.Group,{children:[e.jsx(c,{label:"Points Reward",type:"number",value:r.points_reward,onChange:t=>l({...r,points_reward:t}),suffix:"points",autoComplete:"off"}),e.jsx(c,{label:"Credit Reward",type:"number",value:r.credit_reward,onChange:t=>l({...r,credit_reward:t}),prefix:"$",autoComplete:"off"})]})]})]})}),e.jsx(F,{open:Z,onClose:()=>{_(!1),h(L),u(null)},title:"Create Milestone",primaryAction:{content:"Create Milestone",onAction:oe,loading:Q.isPending},secondaryActions:[{content:"Cancel",onAction:()=>_(!1)}],children:e.jsxs(F.Section,{children:[S&&e.jsx(V,{tone:"critical",onDismiss:()=>u(null),children:S}),e.jsxs(j,{children:[e.jsx(c,{label:"Milestone Name",value:s.name,onChange:t=>h({...s,name:t}),placeholder:"1000 Point Club",autoComplete:"off"}),e.jsx(c,{label:"Description",value:s.description,onChange:t=>h({...s,description:t}),placeholder:"Celebrate reaching 1000 points",multiline:2,autoComplete:"off"}),e.jsxs(j.Group,{children:[e.jsx(q,{label:"Milestone Type",options:Y,value:s.milestone_type,onChange:t=>h({...s,milestone_type:t})}),e.jsx(c,{label:"Threshold",type:"number",value:s.threshold,onChange:t=>h({...s,threshold:t}),helpText:"Value to reach",autoComplete:"off"})]}),e.jsxs(j.Group,{children:[e.jsx(c,{label:"Points Reward",type:"number",value:s.points_reward,onChange:t=>h({...s,points_reward:t}),suffix:"points",autoComplete:"off"}),e.jsx(c,{label:"Credit Reward",type:"number",value:s.credit_reward,onChange:t=>h({...s,credit_reward:t}),prefix:"$",autoComplete:"off"})]}),e.jsx(c,{label:"Celebration Message",value:s.celebration_message,onChange:t=>h({...s,celebration_message:t}),placeholder:"Congratulations! You've reached 1000 points!",multiline:2,autoComplete:"off"})]})]})})]})}export{Ee as EmbeddedGamification,Ee as default};
