import{b as Pe,u as ze,c as T,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as c}from"./vendor-router-CdtyvhQv.js";import{a as w,g as C}from"./index-B6-oWjXE.js";import{c as Re,u as Le}from"./useShopifyData-tW0l9M1P.js";import{P as me,B as M,a0 as xe,v as Ne,L as ee,C as p,a as d,T as n,u as te,h as _,I as E,a5 as se,c as y,a6 as $e,a9 as We,b as ne,D as _e,t as g,Z as qe,W as He,E as Ue,M as D,e as P,g as j,f as ie,z,G as ge,_ as H,O as ye,Y as je,$ as fe,a1 as Ge}from"./vendor-polaris-1WqYVNpP.js";import{T as Qe}from"./vendor-appbridge-DL6abzKC.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";function Je(){const[r,u]=c.useState(()=>{if(typeof window>"u")return{isMobile:!1,isTablet:!1};const l=window.innerWidth;return{isMobile:l<768,isTablet:l>=768&&l<1024}});return c.useEffect(()=>{const l=()=>{const m=window.innerWidth;u({isMobile:m<768,isTablet:m>=768&&m<1024})};return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),r}const Ke=[{label:"Monday",value:"0"},{label:"Tuesday",value:"1"},{label:"Wednesday",value:"2"},{label:"Thursday",value:"3"},{label:"Friday",value:"4"},{label:"Saturday",value:"5"},{label:"Sunday",value:"6"}],ve=[{label:"Never expires",value:""},{label:"30 days",value:"30"},{label:"60 days",value:"60"},{label:"90 days",value:"90"},{label:"180 days",value:"180"},{label:"1 year",value:"365"}];async function Ye(r){const u=await w(`${C()}/promotions/promotions`,r);if(!u.ok)throw new Error("Failed to fetch events");return{events:((await u.json()).promotions||[]).filter(f=>f.promo_type==="purchase_cashback"||f.promo_type==="trade_in_bonus")}}async function Ve(r,u){const l=await w(`${C()}/promotions/promotions`,r,{method:"POST",body:JSON.stringify(u)});if(!l.ok)throw new Error("Failed to create event");return l.json()}async function Xe(r,u,l){const m=await w(`${C()}/promotions/promotions/${u}`,r,{method:"PUT",body:JSON.stringify(l)});if(!m.ok)throw new Error("Failed to update event");return m.json()}async function Ze(r,u){if(!(await w(`${C()}/promotions/promotions/${u}`,r,{method:"DELETE"})).ok)throw new Error("Failed to delete event")}async function et(r,u,l){const m=new URLSearchParams({start_datetime:u,end_datetime:l}),f=await w(`${C()}/store_credit_events/sources?${m}`,r);if(!f.ok)throw new Error("Failed to fetch order sources");return f.json()}async function tt(r,u){const l=await w(`${C()}/store_credit_events/preview`,r,{method:"POST",body:JSON.stringify(u)});if(!l.ok)throw new Error("Failed to preview event");return l.json()}async function st(r,u){const l=await w(`${C()}/store_credit_events/run`,r,{method:"POST",body:JSON.stringify(u)});if(!l.ok)throw new Error("Failed to run event");return l.json()}function ut({shop:r}){const u=Pe(),{isMobile:l,isTablet:m}=Je(),[f,be]=c.useState(0),[Se,k]=c.useState(!1),[I,U]=c.useState(null),[we,R]=c.useState(!1),[G,ae]=c.useState(null),[Ce,L]=c.useState(!1),[v,A]=c.useState(null),[x,N]=c.useState(null),[re,Q]=c.useState([]),[s,h]=c.useState({name:"",description:"",promo_type:"purchase_cashback",bonus_percent:10,starts_at:"",ends_at:"",daily_start_time:"",daily_end_time:"",active_days:[],product_tags_filter:[],collection_ids:[],tier_restriction:[],active:!0,credit_expiration_days:""}),[i,b]=c.useState({start_datetime:"",end_datetime:"",sources:[],credit_percent:10,include_authorized:!0,credit_expiration_days:""}),[J,oe]=c.useState(""),[K,le]=c.useState(""),{data:$}=Re(r),{data:F}=Le(r),{data:ke,isLoading:Te}=ze({queryKey:["scheduled-events",r],queryFn:()=>Ye(r),enabled:!!r}),Ee=c.useMemo(()=>{if(!$?.tags)return[];const t=(J||"").toLowerCase();return(t?$.tags.filter(a=>(a||"").toLowerCase().includes(t)):$.tags).filter(a=>a).map(a=>({value:a,label:a}))},[$,J]),De=c.useMemo(()=>{if(!F?.collections)return[];const t=(K||"").toLowerCase();return(t?F.collections.filter(a=>(a?.title||"").toLowerCase().includes(t)):F.collections).filter(a=>a?.title).map(a=>({value:a.id,label:a.title}))},[F,K]),Y=T({mutationFn:t=>Ve(r,t),onSuccess:()=>{u.invalidateQueries({queryKey:["scheduled-events"]}),k(!1),W()}}),V=T({mutationFn:({id:t,data:o})=>Xe(r,t,o),onSuccess:()=>{u.invalidateQueries({queryKey:["scheduled-events"]}),k(!1),U(null),W()}}),de=T({mutationFn:t=>Ze(r,t),onSuccess:()=>{u.invalidateQueries({queryKey:["scheduled-events"]}),R(!1),ae(null)}}),X=T({mutationFn:()=>et(r,i.start_datetime,i.end_datetime),onSuccess:t=>Q(t.sources)}),ce=T({mutationFn:()=>tt(r,{start_datetime:i.start_datetime,end_datetime:i.end_datetime,sources:i.sources,credit_percent:i.credit_percent,include_authorized:i.include_authorized}),onSuccess:t=>{A(t),N(null)}}),ue=T({mutationFn:()=>st(r,{start_datetime:i.start_datetime,end_datetime:i.end_datetime,sources:i.sources,credit_percent:i.credit_percent,include_authorized:i.include_authorized,expires_at:i.credit_expiration_days?new Date(Date.now()+parseInt(i.credit_expiration_days)*24*60*60*1e3).toISOString():void 0}),onSuccess:t=>{N(t),A(null)}}),W=c.useCallback(()=>{const t=new Date,o=new Date(t.getTime()+10080*60*1e3);h({name:"",description:"",promo_type:"purchase_cashback",bonus_percent:10,starts_at:t.toISOString().slice(0,16),ends_at:o.toISOString().slice(0,16),daily_start_time:"",daily_end_time:"",active_days:[],product_tags_filter:[],collection_ids:[],tier_restriction:[],active:!0,credit_expiration_days:""}),oe(""),le("")},[]),Z=c.useCallback(()=>{b({start_datetime:"",end_datetime:"",sources:[],credit_percent:10,include_authorized:!0,credit_expiration_days:""}),A(null),N(null),Q([])},[]),S=c.useCallback(t=>{if(W(),t){const o=new Date,a=t.duration_hours?new Date(o.getTime()+t.duration_hours*60*60*1e3):new Date(o.getTime()+10080*60*1e3);h(O=>({...O,name:t.name,description:t.description,bonus_percent:t.bonus_percent,daily_start_time:t.daily_start_time||"",daily_end_time:t.daily_end_time||"",active_days:t.active_days||[],starts_at:o.toISOString().slice(0,16),ends_at:a.toISOString().slice(0,16)}))}U(null),k(!0)},[W]),Ie=c.useCallback(t=>{U(t),h({name:t.name,description:t.description||"",promo_type:t.promo_type,bonus_percent:t.bonus_percent,starts_at:t.starts_at?.slice(0,16)||"",ends_at:t.ends_at?.slice(0,16)||"",daily_start_time:t.daily_start_time||"",daily_end_time:t.daily_end_time||"",active_days:t.active_days?t.active_days.split(","):[],product_tags_filter:t.product_tags_filter||[],collection_ids:t.collection_ids||[],tier_restriction:t.tier_restriction||[],active:t.active,credit_expiration_days:""}),k(!0)},[]),q=c.useCallback((t,o)=>{const a=new Date,O=t?new Date(a.getTime()+t*60*60*1e3):new Date(a.getTime()+10800*1e3);b({start_datetime:a.toISOString().slice(0,16),end_datetime:O.toISOString().slice(0,16),sources:[],credit_percent:o||10,include_authorized:!0,credit_expiration_days:""}),A(null),N(null),Q([]),L(!0)},[]),he=c.useCallback((t,o)=>{const a={...i,[t]:o};b(a),a.start_datetime&&a.end_datetime&&X.mutate()},[i,X]),Ae=c.useCallback(()=>{const t={name:s.name,description:s.description||null,promo_type:s.promo_type,bonus_percent:s.bonus_percent,bonus_flat:0,multiplier:1,starts_at:s.starts_at,ends_at:s.ends_at,daily_start_time:s.daily_start_time||null,daily_end_time:s.daily_end_time||null,active_days:s.active_days.length>0?s.active_days.join(","):null,product_tags_filter:s.product_tags_filter.length>0?s.product_tags_filter:null,collection_ids:s.collection_ids.length>0?s.collection_ids:null,tier_restriction:s.tier_restriction.length>0?s.tier_restriction:null,channel:"all",stackable:!0,active:s.active,credit_expiration_days:s.credit_expiration_days?parseInt(s.credit_expiration_days):null};I?V.mutate({id:I.id,data:t}):Y.mutate(t)},[s,I,Y,V]),B=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),Fe=t=>t.active?t.is_active_now?e.jsx(g,{tone:"success",children:"Active Now"}):t.starts_at&&new Date(t.starts_at)>new Date?e.jsx(g,{tone:"info",children:"Scheduled"}):e.jsx(g,{tone:"warning",children:"Ended"}):e.jsx(g,{children:"Disabled"}),Be=t=>{const o=[];if(t.daily_start_time&&t.daily_end_time&&o.push(`${t.daily_start_time} - ${t.daily_end_time}`),t.active_days){const a=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],O=t.active_days.split(",").map(Me=>a[parseInt(Me)]);o.push(O.join(", "))}return o.length>0?o.join(" on "):"All times"},Oe=[{id:"scheduled",content:"Scheduled Events",panelID:"scheduled-panel"},{id:"bulk",content:"Bulk Credit Events",panelID:"bulk-panel"}];if(!r)return e.jsx(me,{title:"Store Credit Events",children:e.jsx(M,{tone:"warning",children:e.jsx("p",{children:"No shop connected. Please install the app from the Shopify App Store."})})});const pe=ke?.events||[];return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{title:"Store Credit Events",children:e.jsx("button",{variant:"primary",onClick:()=>S(),children:"New Event"})}),e.jsxs(me,{title:"Store Credit Events",subtitle:"Create bonus events to reward customers with store credit",primaryAction:{content:"New Scheduled Event",icon:Ne,onAction:()=>S()},secondaryActions:[{content:"Run Bulk Event",icon:xe,onAction:()=>q()}],children:[e.jsxs(ee,{children:[e.jsx(ee.Section,{children:e.jsx(p,{children:e.jsxs(d,{gap:"400",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Quick Start Templates"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Use a template to quickly create common bonus events"}),e.jsxs(te,{columns:l?1:m?2:4,gap:"300",children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(d,{gap:"200",children:[e.jsxs(_,{gap:"200",blockAlign:"center",children:[e.jsx(E,{source:se}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Black Friday"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"+10% store credit on all purchases during Black Friday weekend"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(y,{size:"slim",onClick:()=>S({name:"Black Friday Bonus",description:"Earn 10% store credit on all purchases this Black Friday weekend!",bonus_percent:10,duration_hours:72}),children:"Use Template"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(d,{gap:"200",children:[e.jsxs(_,{gap:"200",blockAlign:"center",children:[e.jsx(E,{source:$e}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Trade Night"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Saturday 6-9pm bonus for in-store trades and purchases"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(y,{size:"slim",onClick:()=>S({name:"Saturday Trade Night",description:"Extra 10% store credit on Saturday evening purchases!",bonus_percent:10,daily_start_time:"18:00",daily_end_time:"21:00",active_days:["5"]}),children:"Use Template"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(d,{gap:"200",children:[e.jsxs(_,{gap:"200",blockAlign:"center",children:[e.jsx(E,{source:se}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Weekend Warrior"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"+5% store credit on all weekend purchases"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(y,{size:"slim",onClick:()=>S({name:"Weekend Bonus",description:"Earn 5% store credit on all weekend purchases!",bonus_percent:5,active_days:["5","6"]}),children:"Use Template"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(d,{gap:"200",children:[e.jsxs(_,{gap:"200",blockAlign:"center",children:[e.jsx(E,{source:se}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Grand Opening"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"+15% store credit on opening day purchases"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(y,{size:"slim",onClick:()=>S({name:"Grand Opening Bonus",description:"Celebrate our grand opening with 15% store credit!",bonus_percent:15,duration_hours:24}),children:"Use Template"})})]})})})]})]})})}),e.jsx(ee.Section,{children:e.jsxs(We,{tabs:Oe,selected:f,onSelect:be,children:[f===0&&e.jsx(p,{children:Te?e.jsx(d,{gap:"400",children:[1,2,3].map(t=>e.jsx(ne,{paddingBlock:"300",children:e.jsxs(_,{gap:"400",blockAlign:"center",children:[e.jsx(ne,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"20px",minWidth:"150px"}),e.jsx(ne,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"20px",minWidth:"100px"})]})},t))}):pe.length>0?e.jsx(_e,{columnContentTypes:["text","text","text","text","text","text"],headings:["Event Name","Bonus","Schedule","Date Range","Status","Actions"],rows:pe.map(t=>[e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",fontWeight:"semibold",children:t.name}),t.product_tags_filter&&t.product_tags_filter.length>0&&e.jsx(_,{gap:"100",children:t.product_tags_filter.slice(0,2).map(o=>e.jsx(g,{size:"small",children:o},o))})]},t.id),e.jsx(g,{tone:"success",children:`+${t.bonus_percent}%`},t.id),Be(t),e.jsxs(n,{as:"span",variant:"bodySm",children:[t.starts_at?new Date(t.starts_at).toLocaleDateString():"—"," - ",t.ends_at?new Date(t.ends_at).toLocaleDateString():"—"]},t.id),Fe(t),e.jsxs(_,{gap:"200",children:[e.jsx(y,{size:"slim",icon:qe,onClick:()=>Ie(t),accessibilityLabel:`Edit ${t.name}`}),e.jsx(y,{size:"slim",icon:He,tone:"critical",onClick:()=>{ae(t),R(!0)},accessibilityLabel:`Delete ${t.name}`})]},t.id)])}):e.jsx(Ue,{heading:"No scheduled events yet",action:{content:"Create your first event",onAction:()=>S()},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Schedule store credit bonus events to reward your customers during special periods."})})}),f===1&&e.jsxs(d,{gap:"400",children:[e.jsx(p,{children:e.jsxs(d,{gap:"300",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Run a Retroactive Bulk Event"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Issue store credit to customers based on their past orders. Great for rewarding customers after a busy sales period."}),e.jsxs(te,{columns:l?1:m?2:3,gap:"300",children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"100px"},children:[e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Trade Night Recap"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Issue 10% credit for orders from the last 3 hours"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(y,{size:"slim",onClick:()=>q(3,10),children:"Run Event"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"100px"},children:[e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Weekend Recap"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Issue 5% credit for orders from the last 48 hours"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(y,{size:"slim",onClick:()=>q(48,5),children:"Run Event"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"100px"},children:[e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Custom Event"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Configure your own date range and credit percentage"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(y,{size:"slim",variant:"primary",onClick:()=>q(),children:"Create Custom"})})]})})})]})]})}),e.jsx(p,{children:e.jsxs(d,{gap:"300",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"How Bulk Events Work"}),e.jsxs(d,{gap:"200",children:[e.jsxs(_,{gap:"200",blockAlign:"start",children:[e.jsx(g,{tone:"info",children:"1"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Set Date Range:"})," Choose the period to include orders from"]})]}),e.jsxs(_,{gap:"200",blockAlign:"start",children:[e.jsx(g,{tone:"info",children:"2"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Select Sources:"})," Filter by POS, Web, or all channels"]})]}),e.jsxs(_,{gap:"200",blockAlign:"start",children:[e.jsx(g,{tone:"info",children:"3"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Preview:"})," See exactly how much credit will be issued"]})]}),e.jsxs(_,{gap:"200",blockAlign:"start",children:[e.jsx(g,{tone:"success",children:"4"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Apply:"})," Issue store credit to all qualifying customers"]})]})]})]})})]})]})})]}),e.jsx(D,{open:Se,onClose:()=>k(!1),title:I?"Edit Store Credit Event":"New Store Credit Event",primaryAction:{content:I?"Save Changes":"Create Event",onAction:Ae,loading:Y.isPending||V.isPending},secondaryActions:[{content:"Cancel",onAction:()=>k(!1)}],children:e.jsx(D.Section,{children:e.jsxs(P,{children:[e.jsx(j,{label:"Event Name",value:s.name,onChange:t=>h({...s,name:t}),autoComplete:"off",requiredIndicator:!0,placeholder:"e.g., Black Friday Bonus, Saturday Trade Night"}),e.jsx(j,{label:"Description",value:s.description,onChange:t=>h({...s,description:t}),multiline:2,autoComplete:"off",helpText:"Shown to customers in their account"}),e.jsx(ie,{label:"Bonus Type",options:[{label:"Purchase Cashback (% of order total)",value:"purchase_cashback"},{label:"Trade-In Bonus (% extra on trade-ins)",value:"trade_in_bonus"}],value:s.promo_type,onChange:t=>h({...s,promo_type:t})}),e.jsx(j,{label:"Bonus Percentage",type:"number",value:s.bonus_percent.toString(),onChange:t=>h({...s,bonus_percent:parseFloat(t)||0}),suffix:"%",autoComplete:"off",helpText:"Percentage of order/trade-in value to credit"}),e.jsx(z,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Date Range"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"The event will be active from start date through end date"}),e.jsxs(P.Group,{children:[e.jsx(j,{label:"Start Date",type:"date",value:s.starts_at.split("T")[0],onChange:t=>h({...s,starts_at:t+"T00:00"}),autoComplete:"off",requiredIndicator:!0}),e.jsx(j,{label:"End Date",type:"date",value:s.ends_at.split("T")[0],onChange:t=>h({...s,ends_at:t+"T23:59"}),autoComplete:"off",requiredIndicator:!0})]}),e.jsx(z,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Daily Time Window (Optional)"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Limit this bonus to specific hours each day (e.g., 6-9pm trade nights)"}),e.jsxs(P.Group,{children:[e.jsx(j,{label:"Daily Start Time",type:"time",value:s.daily_start_time,onChange:t=>h({...s,daily_start_time:t}),autoComplete:"off",helpText:"e.g., 18:00 for 6 PM"}),e.jsx(j,{label:"Daily End Time",type:"time",value:s.daily_end_time,onChange:t=>h({...s,daily_end_time:t}),autoComplete:"off",helpText:"e.g., 21:00 for 9 PM"})]}),e.jsx(ge,{title:"Active Days",choices:Ke,selected:s.active_days,onChange:t=>h({...s,active_days:t}),allowMultiple:!0}),e.jsx(z,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Product Filters (Optional)"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Only apply this bonus to specific products"}),e.jsxs(d,{gap:"200",children:[e.jsx(H,{options:Ee,selected:s.product_tags_filter,onSelect:t=>h({...s,product_tags_filter:t}),textField:e.jsx(H.TextField,{label:"Product Tags",value:J,onChange:oe,placeholder:"e.g., pokemon, sports-cards",prefix:e.jsx(E,{source:ye}),autoComplete:"off"}),allowMultiple:!0}),s.product_tags_filter.length>0&&e.jsx(_,{gap:"100",wrap:!0,children:s.product_tags_filter.map(t=>e.jsx(je,{onRemove:()=>h({...s,product_tags_filter:s.product_tags_filter.filter(o=>o!==t)}),children:t},t))})]}),e.jsxs(d,{gap:"200",children:[e.jsx(H,{options:De,selected:s.collection_ids,onSelect:t=>h({...s,collection_ids:t}),textField:e.jsx(H.TextField,{label:"Collections",value:K,onChange:le,placeholder:"Search collections...",prefix:e.jsx(E,{source:ye}),autoComplete:"off"}),allowMultiple:!0}),s.collection_ids.length>0&&e.jsx(_,{gap:"100",wrap:!0,children:s.collection_ids.map(t=>{const o=F?.collections?.find(a=>a?.id===t);return e.jsx(je,{onRemove:()=>h({...s,collection_ids:s.collection_ids.filter(a=>a!==t)}),children:o?.title||t},t)})})]}),e.jsx(z,{}),e.jsx(ie,{label:"Credit Expiration",options:ve,value:s.credit_expiration_days,onChange:t=>h({...s,credit_expiration_days:t}),helpText:"How long before credited amounts expire"}),e.jsx(fe,{label:"Event is active",checked:s.active,onChange:t=>h({...s,active:t})})]})})}),e.jsx(D,{open:we,onClose:()=>R(!1),title:"Delete Event",primaryAction:{content:"Delete",destructive:!0,onAction:()=>G&&de.mutate(G.id),loading:de.isPending},secondaryActions:[{content:"Cancel",onAction:()=>R(!1)}],children:e.jsx(D.Section,{children:e.jsxs(n,{as:"p",children:['Are you sure you want to delete "',G?.name,'"? This action cannot be undone.']})})}),e.jsx(D,{open:Ce,onClose:()=>{L(!1),Z()},title:"Run Bulk Store Credit Event",size:"large",primaryAction:v&&!x?{content:"Apply Credits",icon:xe,onAction:()=>ue.mutate(),loading:ue.isPending}:x?{content:"Done",onAction:()=>{L(!1),Z()}}:{content:"Preview (Dry Run)",icon:Ge,onAction:()=>ce.mutate(),loading:ce.isPending,disabled:!i.start_datetime||!i.end_datetime||i.sources.length===0},secondaryActions:x?[]:[{content:"Cancel",onAction:()=>{L(!1),Z()}}],children:e.jsx(D.Section,{children:x?e.jsxs(d,{gap:"400",children:[e.jsx(M,{title:x.success_count>0?"Event Completed Successfully!":"Event Completed",tone:x.failure_count>0?"warning":"success",children:e.jsxs("p",{children:["Issued ",B(x.total_credit_issued)," in store credit to ",x.success_count," customers.",x.failure_count>0&&` ${x.failure_count} failed.`]})}),x.errors&&x.errors.length>0&&e.jsx(p,{children:e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",tone:"critical",children:"Errors"}),x.errors.slice(0,10).map((t,o)=>e.jsx(n,{as:"p",variant:"bodySm",children:t},o))]})})]}):v?e.jsxs(d,{gap:"400",children:[e.jsx(M,{title:"Preview Results",tone:"info",children:e.jsx("p",{children:'This is a dry run. No credits have been issued yet. Review the data below and click "Apply Credits" to proceed.'})}),e.jsxs(te,{columns:l||m?2:4,gap:"300",children:[e.jsx(p,{children:e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Total Orders"}),e.jsx(n,{as:"p",variant:"headingLg",children:v.summary.total_orders})]})}),e.jsx(p,{children:e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Unique Customers"}),e.jsx(n,{as:"p",variant:"headingLg",children:v.summary.unique_customers})]})}),e.jsx(p,{children:e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Total Order Value"}),e.jsx(n,{as:"p",variant:"headingLg",children:B(v.summary.total_order_value)})]})}),e.jsx(p,{children:e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Credit to Issue"}),e.jsx(n,{as:"p",variant:"headingLg",tone:"success",children:B(v.summary.total_credit_to_issue)})]})})]}),v.top_customers&&v.top_customers.length>0&&e.jsx(p,{children:e.jsxs(d,{gap:"300",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Top Customers by Credit"}),e.jsx(_e,{columnContentTypes:["text","text","numeric","numeric","numeric"],headings:["Customer","Email","Orders","Spent","Credit"],rows:v.top_customers.slice(0,5).map(t=>[t.name||"Guest",t.email||"-",t.order_count||0,B(t.total_spent||0),e.jsx(g,{tone:"success",children:B(t.credit_amount||0)},t.customer_id)])})]})}),e.jsx(y,{onClick:()=>A(null),variant:"plain",children:"Back to Edit"})]}):e.jsxs(P,{children:[e.jsx(M,{tone:"info",children:e.jsx("p",{children:'Configure your bulk credit event. After setting up, click "Preview (Dry Run)" to see exactly what will happen.'})}),e.jsxs(P.Group,{children:[e.jsx(j,{label:"Start Date & Time",type:"datetime-local",value:i.start_datetime,onChange:t=>he("start_datetime",t),autoComplete:"off",requiredIndicator:!0,helpText:"Include orders created after this time"}),e.jsx(j,{label:"End Date & Time",type:"datetime-local",value:i.end_datetime,onChange:t=>he("end_datetime",t),autoComplete:"off",requiredIndicator:!0,helpText:"Include orders created before this time"})]}),e.jsx(j,{label:"Credit Percentage",type:"number",value:i.credit_percent.toString(),onChange:t=>b({...i,credit_percent:parseFloat(t)||0}),suffix:"%",autoComplete:"off",helpText:"Percentage of order total to issue as store credit"}),e.jsxs(d,{gap:"200",children:[e.jsxs(n,{as:"span",variant:"bodyMd",children:["Order Sources ",e.jsx(n,{as:"span",tone:"critical",children:"*"})]}),X.isPending?e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Loading available sources..."}):re.length>0?e.jsx(ge,{title:"",choices:re.map(t=>({label:`${t.name} (${t.count} orders)`,value:t.name})),selected:i.sources,onChange:t=>b({...i,sources:t}),allowMultiple:!0}):i.start_datetime&&i.end_datetime?e.jsx(M,{tone:"warning",children:e.jsx("p",{children:"No orders found in this date range. Try adjusting the dates."})}):e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Select start and end dates to see available order sources."})]}),e.jsx(z,{}),e.jsx(ie,{label:"Credit Expiration",options:ve,value:i.credit_expiration_days,onChange:t=>b({...i,credit_expiration_days:t}),helpText:"How long before issued credits expire"}),e.jsx(fe,{label:"Include authorized (unpaid) orders",checked:i.include_authorized,onChange:t=>b({...i,include_authorized:t})})]})})})]})]})}export{ut as EmbeddedStoreCreditEvents,ut as default};
