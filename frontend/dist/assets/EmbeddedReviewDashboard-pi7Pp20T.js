import{u as T,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as _}from"./vendor-router-CdtyvhQv.js";import{a as I,g as P}from"./index-D10Yqe92.js";import{P as m,B as y,b as C,h as n,l as W,L as h,C as l,T as s,f as E,u as F,a as t,I as v,p as L,z as g,t as u,ap as z,o as B,S as N,k as D,aq as V,D as q}from"./vendor-polaris-1WqYVNpP.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";function H(){const[o,b]=_.useState(()=>{if(typeof window>"u")return{isSmallMobile:!1,isMobile:!1,isTablet:!1};const a=window.innerWidth;return{isSmallMobile:a<480,isMobile:a<768,isTablet:a<1024}});return _.useEffect(()=>{const a=()=>{const d=window.innerWidth;b({isSmallMobile:d<480,isMobile:d<768,isTablet:d<1024})};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),o}async function $(o,b){const a=await I(`${P()}/review-dashboard/metrics?days=${b}`,o);if(!a.ok)throw new Error("Failed to fetch review metrics");return(await a.json()).metrics}function Y({shop:o}){const{isSmallMobile:b,isMobile:a}=H(),[d,M]=_.useState("30"),{data:c,isLoading:S,error:k}=T({queryKey:["review-dashboard",o,d],queryFn:()=>$(o,d),enabled:!!o}),r=i=>new Intl.NumberFormat("en-US").format(i),p=i=>`${i.toFixed(1)}%`;if(!o)return e.jsx(m,{title:"Review Tracking",children:e.jsx(y,{tone:"warning",children:e.jsx("p",{children:"No shop connected. Please install the app from the Shopify App Store."})})});if(S)return e.jsx(m,{title:"Review Tracking",children:e.jsx(C,{padding:"1600",children:e.jsx(n,{align:"center",children:e.jsx(W,{size:"large"})})})});if(k)return e.jsx(m,{title:"Review Tracking",children:e.jsx(y,{tone:"critical",children:e.jsx("p",{children:"Failed to load review metrics. Please try refreshing the page."})})});const A=c?.overview||{total_prompts_sent:0},x=c?.in_app_prompts||{total_impressions:0,clicked_count:0,dismissed_count:0,reminded_later_count:0,click_rate:0,response_rate:0},j=c?.support_review_emails||{total_sent:0,total_opened:0,total_clicked:0,open_rate:0,click_rate:0,click_to_open_rate:0},f=c?.top_reviewers||[],w=c?.weekly_velocity||[],R=Math.max(...w.map(i=>i.reviews),1);return e.jsx(m,{title:"Review Tracking",subtitle:"Monitor your app review collection progress",backAction:{content:"Settings",url:"/app/settings"},children:e.jsxs(h,{children:[e.jsx(h.Section,{children:e.jsx(l,{children:e.jsxs(n,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"Reporting Period"}),e.jsx(E,{label:"",labelHidden:!0,options:[{label:"Last 7 days",value:"7"},{label:"Last 30 days",value:"30"},{label:"Last 90 days",value:"90"},{label:"All time",value:"0"}],value:d,onChange:M})]})})}),e.jsx(h.Section,{children:e.jsxs(F,{columns:b?1:a?2:4,gap:a?"300":"400",children:[e.jsx(l,{children:e.jsxs(t,{gap:"300",children:[e.jsxs(n,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"Reviews Collected"}),e.jsx(v,{source:L,tone:"warning"})]}),e.jsx(s,{as:"p",variant:"heading2xl",children:r(c?.total_reviews_collected||0)}),e.jsx(g,{}),e.jsx(s,{as:"span",variant:"bodySm",tone:"subdued",children:"Total clicks to review page"})]})}),e.jsx(l,{children:e.jsxs(t,{gap:"300",children:[e.jsxs(n,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"Average Rating"}),e.jsx(u,{tone:"success",children:"Estimated"})]}),e.jsx(s,{as:"p",variant:"heading2xl",children:(c?.average_rating||4.8).toFixed(1)}),e.jsx(g,{}),e.jsx(s,{as:"span",variant:"bodySm",tone:"subdued",children:"Based on industry average for engaged users"})]})}),e.jsx(l,{children:e.jsxs(t,{gap:"300",children:[e.jsxs(n,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"Conversion Rate"}),e.jsx(v,{source:z,tone:"info"})]}),e.jsx(s,{as:"p",variant:"heading2xl",children:p(c?.prompt_to_review_conversion_rate||0)}),e.jsx(g,{}),e.jsx(s,{as:"span",variant:"bodySm",tone:"subdued",children:"Prompts to review clicks"})]})}),e.jsx(l,{children:e.jsxs(t,{gap:"300",children:[e.jsxs(n,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"Total Prompts"}),e.jsx(u,{children:"Combined"})]}),e.jsx(s,{as:"p",variant:"heading2xl",children:r(A.total_prompts_sent)}),e.jsx(g,{}),e.jsx(s,{as:"span",variant:"bodySm",tone:"subdued",children:"In-app + email prompts sent"})]})})]})}),e.jsx(h.Section,{children:e.jsx(l,{children:e.jsxs(t,{gap:"400",children:[e.jsxs(n,{align:"space-between",blockAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"Review Velocity (Reviews per Week)"}),e.jsx(u,{tone:"info",children:"Trend"})]}),w.length>0?e.jsx(t,{gap:"200",children:w.slice(-8).map(i=>e.jsxs(t,{gap:"100",children:[e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodySm",children:i.week}),e.jsxs(s,{as:"span",variant:"bodySm",fontWeight:"semibold",children:[r(i.reviews)," reviews"]})]}),e.jsx(B,{progress:i.reviews/R*100,size:"small",tone:"primary"})]},i.week))}):e.jsx(s,{as:"p",tone:"subdued",children:"No review data available for this period"})]})})}),e.jsx(h.Section,{variant:"oneHalf",children:e.jsx(l,{children:e.jsxs(t,{gap:"400",children:[e.jsxs(n,{gap:"200",blockAlign:"center",children:[e.jsx(v,{source:N,tone:"base"}),e.jsx(s,{as:"h3",variant:"headingMd",children:"In-App Prompts"})]}),e.jsx(g,{}),e.jsxs(t,{gap:"200",children:[e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:"Total Impressions"}),e.jsx(s,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:r(x.total_impressions)})]}),e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:"Clicked (Rate Now)"}),e.jsxs(s,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:[r(x.clicked_count)," (",p(x.click_rate),")"]})]}),e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:"Dismissed"}),e.jsx(s,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:r(x.dismissed_count)})]}),e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:"Remind Later"}),e.jsx(s,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:r(x.reminded_later_count)})]}),e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:"Response Rate"}),e.jsx(s,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:p(x.response_rate)})]})]})]})})}),e.jsx(h.Section,{variant:"oneHalf",children:e.jsx(l,{children:e.jsxs(t,{gap:"400",children:[e.jsxs(n,{gap:"200",blockAlign:"center",children:[e.jsx(v,{source:D,tone:"base"}),e.jsx(s,{as:"h3",variant:"headingMd",children:"Post-Support Emails"})]}),e.jsx(g,{}),e.jsxs(t,{gap:"200",children:[e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:"Total Sent"}),e.jsx(s,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:r(j.total_sent)})]}),e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:"Opened"}),e.jsxs(s,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:[r(j.total_opened)," (",p(j.open_rate),")"]})]}),e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:"Clicked"}),e.jsxs(s,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:[r(j.total_clicked)," (",p(j.click_rate),")"]})]}),e.jsxs(n,{align:"space-between",children:[e.jsx(s,{as:"span",variant:"bodyMd",children:"Click-to-Open Rate"}),e.jsx(s,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:p(j.click_to_open_rate)})]})]})]})})}),e.jsx(h.Section,{children:e.jsx(l,{children:e.jsxs(t,{gap:"400",children:[e.jsxs(n,{align:"space-between",blockAlign:"center",children:[e.jsxs(n,{gap:"200",blockAlign:"center",children:[e.jsx(v,{source:V,tone:"base"}),e.jsx(s,{as:"h3",variant:"headingMd",children:"Top Engaged Members"})]}),e.jsx(u,{tone:"success",children:"Most Active"})]}),f.length>0?e.jsx(q,{columnContentTypes:["text","text","numeric"],headings:["Member","Member #","Trade-Ins"],rows:f.slice(0,10).map(i=>[i.name,i.member_number||"-",r(i.total_trade_ins)])}):e.jsx(s,{as:"p",tone:"subdued",children:"No member data available for this period"})]})})}),e.jsx(h.Section,{children:e.jsx(y,{tone:"info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"}),' The Shopify App Store API does not provide access to actual review counts or ratings. "Reviews Collected" represents clicks to the review page. "Average Rating" is an estimate based on industry benchmarks for engaged users (typically 4.5-5.0 stars).']})})})]})})}export{Y as EmbeddedReviewDashboard};
