import{b as q,u as D,c as w,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as b}from"./vendor-router-CdtyvhQv.js";import{a as g,g as f}from"./index-D10Yqe92.js";import{c as M,P as S,C as d,a as c,l as B,T as s,L as x,D as R,M as A,B as L,e as p,g as i,f as G,t as u}from"./vendor-polaris-1WqYVNpP.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";const j={name:"",cashback_rate:"5",min_purchase:"0",max_cashback:"50",start_date:"",end_date:"",applies_to:"all",budget:"1000"};async function N(r){const h=await g(`${f()}/cashback/campaigns`,r);if(!h.ok)throw new Error("Failed to fetch campaigns");return h.json()}function U({shop:r}){const[h,o]=b.useState(!1),[t,n]=b.useState(j),[C,m]=b.useState(null),y=q(),{data:F,isLoading:$}=D({queryKey:["cashback-campaigns",r],queryFn:()=>N(r),enabled:!!r}),k=w({mutationFn:async a=>{const l=await g(`${f()}/cashback/campaigns`,r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.name,cashback_rate:parseFloat(a.cashback_rate),min_purchase:parseFloat(a.min_purchase),max_cashback:parseFloat(a.max_cashback),start_date:a.start_date,end_date:a.end_date,applies_to:a.applies_to,budget:parseFloat(a.budget)})});if(!l.ok)throw new Error("Failed to create campaign");return l.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["cashback-campaigns",r]}),o(!1),n(j)},onError:a=>{m(a.message)}}),v=w({mutationFn:async a=>{const l=await g(`${f()}/cashback/campaigns/${a}/activate`,r,{method:"POST"});if(!l.ok)throw new Error("Failed to activate campaign");return l.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["cashback-campaigns",r]})}}),T=()=>{if(!t.name||!t.cashback_rate||!t.start_date||!t.end_date){m("Please fill in all required fields");return}k.mutate(t)},E=a=>{switch(a){case"active":return e.jsx(u,{tone:"success",children:"Active"});case"scheduled":return e.jsx(u,{tone:"info",children:"Scheduled"});case"ended":return e.jsx(u,{children:"Ended"});case"draft":return e.jsx(u,{tone:"attention",children:"Draft"});default:return e.jsx(u,{children:a})}},_=F?.campaigns||[],P=_.map(a=>[a.name,`${a.cashback_rate}%`,`$${a.min_purchase}`,`$${a.max_cashback}`,E(a.status),`$${a.total_awarded.toFixed(2)}`,a.redemption_count,a.status==="draft"?e.jsx(M,{size:"slim",onClick:()=>v.mutate(a.id),loading:v.isPending,children:"Activate"}):null]);return $?e.jsx(S,{title:"Cashback Campaigns",children:e.jsx(d,{children:e.jsxs(c,{gap:"200",inlineAlign:"center",children:[e.jsx(B,{size:"large"}),e.jsx(s,{as:"p",children:"Loading campaigns..."})]})})}):e.jsxs(S,{title:"Cashback Campaigns",subtitle:"Run promotional cashback periods to drive sales",primaryAction:{content:"Create Campaign",onAction:()=>o(!0)},children:[e.jsxs(x,{children:[e.jsx(x.Section,{children:_.length===0?e.jsx(d,{children:e.jsxs(c,{gap:"300",inlineAlign:"center",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"No campaigns yet"}),e.jsx(s,{as:"p",variant:"bodyMd",tone:"subdued",children:"Create your first cashback campaign to automatically reward customers with store credit."}),e.jsx(M,{variant:"primary",onClick:()=>o(!0),children:"Create Campaign"})]})}):e.jsx(d,{children:e.jsx(R,{columnContentTypes:["text","numeric","numeric","numeric","text","numeric","numeric","text"],headings:["Campaign","Rate","Min Purchase","Max Cashback","Status","Total Awarded","Redemptions","Actions"],rows:P})})}),e.jsxs(x.Section,{variant:"oneThird",children:[e.jsx(d,{children:e.jsxs(c,{gap:"300",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"How It Works"}),e.jsx(s,{as:"p",variant:"bodyMd",tone:"subdued",children:"Cashback campaigns automatically award store credit when customers complete qualifying purchases."}),e.jsxs(c,{gap:"200",children:[e.jsx(s,{as:"p",variant:"bodyMd",children:"1. Set your cashback rate (e.g., 5%)"}),e.jsx(s,{as:"p",variant:"bodyMd",children:"2. Define minimum purchase requirements"}),e.jsx(s,{as:"p",variant:"bodyMd",children:"3. Set campaign dates"}),e.jsx(s,{as:"p",variant:"bodyMd",children:"4. Activate and watch credits flow!"})]})]})}),e.jsx(d,{children:e.jsxs(c,{gap:"300",children:[e.jsx(s,{as:"h3",variant:"headingMd",children:"Campaign Ideas"}),e.jsxs(c,{gap:"100",children:[e.jsx(s,{as:"p",variant:"bodyMd",children:"Double cashback weekend"}),e.jsx(s,{as:"p",variant:"bodyMd",children:"VIP member exclusive 10% back"}),e.jsx(s,{as:"p",variant:"bodyMd",children:"Holiday shopping bonus"}),e.jsx(s,{as:"p",variant:"bodyMd",children:"New product launch promo"})]})]})})]})]}),e.jsx(A,{open:h,onClose:()=>{o(!1),n(j),m(null)},title:"Create Cashback Campaign",primaryAction:{content:"Create Campaign",onAction:T,loading:k.isPending},secondaryActions:[{content:"Cancel",onAction:()=>o(!1)}],children:e.jsxs(A.Section,{children:[C&&e.jsx(L,{tone:"critical",onDismiss:()=>m(null),children:C}),e.jsxs(p,{children:[e.jsx(i,{label:"Campaign Name",value:t.name,onChange:a=>n({...t,name:a}),placeholder:"Summer Cashback Special",autoComplete:"off"}),e.jsxs(p.Group,{children:[e.jsx(i,{label:"Cashback Rate (%)",type:"number",value:t.cashback_rate,onChange:a=>n({...t,cashback_rate:a}),suffix:"%",autoComplete:"off"}),e.jsx(i,{label:"Budget",type:"number",value:t.budget,onChange:a=>n({...t,budget:a}),prefix:"$",autoComplete:"off"})]}),e.jsxs(p.Group,{children:[e.jsx(i,{label:"Minimum Purchase",type:"number",value:t.min_purchase,onChange:a=>n({...t,min_purchase:a}),prefix:"$",autoComplete:"off"}),e.jsx(i,{label:"Maximum Cashback",type:"number",value:t.max_cashback,onChange:a=>n({...t,max_cashback:a}),prefix:"$",autoComplete:"off"})]}),e.jsxs(p.Group,{children:[e.jsx(i,{label:"Start Date",type:"date",value:t.start_date,onChange:a=>n({...t,start_date:a}),autoComplete:"off"}),e.jsx(i,{label:"End Date",type:"date",value:t.end_date,onChange:a=>n({...t,end_date:a}),autoComplete:"off"})]}),e.jsx(G,{label:"Applies To",options:[{label:"All Customers",value:"all"},{label:"Members Only",value:"members"},{label:"Gold Tier",value:"tier:gold"},{label:"Silver Tier",value:"tier:silver"}],value:t.applies_to,onChange:a=>n({...t,applies_to:a})})]})]})})]})}export{U as EmbeddedCashback,U as default};
