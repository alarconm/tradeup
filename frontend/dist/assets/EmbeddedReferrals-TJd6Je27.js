import{u as y,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as b}from"./vendor-router-CdtyvhQv.js";import{a as M,g as R}from"./index-r9c0LRG1.js";import{P as g,B as m,b as A,h as c,l as E,L as p,u as F,C as h,a,T as n,t as l,D as _,E as w,c as v,M as S,g as j,f as P}from"./vendor-polaris-1WqYVNpP.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";function L(t=768){const[o,d]=b.useState(typeof window<"u"?window.innerWidth<t:!1);return b.useEffect(()=>{const f=()=>d(window.innerWidth<t);return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[t]),o}async function B(t){const o=await M(`${R()}/referrals/admin/stats`,t);if(!o.ok)throw new Error("Failed to fetch referral stats");const d=await o.json();return{total_referrals:d.stats?.total_referrals||0,monthly_referrals:d.stats?.total_referrals||0,total_credit_issued:d.stats?.total_credit_issued||0,top_referrers:d.top_referrers||[],recent_referrals:d.recent_referrals||[]}}async function N(t){const o=await M(`${R()}/referrals/admin/config`,t);if(!o.ok)throw new Error("Failed to fetch referral config");return o.json()}function z({shop:t}){const o=L(),[d,f]=b.useState(!1),{data:s,isLoading:C,error:T}=y({queryKey:["referral-stats",t],queryFn:()=>B(t),enabled:!!t}),{data:i}=y({queryKey:["referral-config",t],queryFn:()=>N(t),enabled:!!t}),x=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r),k=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return t?C?e.jsx(g,{title:"Referral Program",children:e.jsx(A,{padding:"1600",children:e.jsx(c,{align:"center",children:e.jsx(E,{size:"large"})})})}):T?e.jsx(g,{title:"Referral Program",children:e.jsx(m,{tone:"critical",children:e.jsx("p",{children:"Failed to load referral data. Please try refreshing the page."})})}):e.jsxs(g,{title:"Referral Program",subtitle:"Grow your membership through word-of-mouth",primaryAction:{content:"Configure Rewards",onAction:()=>f(!0)},children:[e.jsxs(p,{children:[e.jsx(p.Section,{children:e.jsxs(F,{columns:o?1:{xs:1,sm:2,md:2,lg:4},gap:"400",children:[e.jsx(h,{children:e.jsxs(a,{gap:"200",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Total Referrals"}),e.jsx(n,{as:"p",variant:"heading2xl",children:s?.total_referrals||0}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"All-time successful referrals"})]})}),e.jsx(h,{children:e.jsxs(a,{gap:"200",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"This Month"}),e.jsx(n,{as:"p",variant:"heading2xl",children:s?.monthly_referrals||0}),e.jsx(l,{tone:"success",children:s?.monthly_referrals&&s?.total_referrals?`${Math.round(s.monthly_referrals/s.total_referrals*100)}% of total`:"0%"})]})}),e.jsx(h,{children:e.jsxs(a,{gap:"200",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Credits Issued"}),e.jsx(n,{as:"p",variant:"heading2xl",children:x(s?.total_credit_issued||0)}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Total referral rewards"})]})}),e.jsx(h,{children:e.jsxs(a,{gap:"200",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Avg. per Referrer"}),e.jsx(n,{as:"p",variant:"heading2xl",children:s?.top_referrers&&s.top_referrers.length>0?(s.top_referrers.reduce((r,u)=>r+u.referral_count,0)/s.top_referrers.length).toFixed(1):"0"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Referrals per active referrer"})]})})]})}),i&&e.jsx(p.Section,{children:e.jsx(h,{children:e.jsxs(a,{gap:"300",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Current Reward Structure"}),e.jsxs(c,{gap:"600",children:[e.jsxs(a,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Referrer Reward"}),e.jsx(n,{as:"span",variant:"headingMd",children:x(i.config.referrer_credit)})]}),e.jsxs(a,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"New Member Reward"}),e.jsx(n,{as:"span",variant:"headingMd",children:x(i.config.referee_credit)})]}),e.jsxs(a,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Granted On"}),e.jsx(l,{tone:i.config.grant_on_signup?"success":"info",children:i.config.grant_on_signup?"Signup":"First Purchase"})]}),e.jsxs(a,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Monthly Limit"}),e.jsxs(n,{as:"span",variant:"headingMd",children:[i.config.max_referrals_per_month," per member"]})]})]})]})})}),e.jsx(p.Section,{variant:"oneHalf",children:e.jsx(h,{children:e.jsxs(a,{gap:"400",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Top Referrers"}),e.jsx(l,{tone:"info",children:"Leaderboard"})]}),s?.top_referrers&&s.top_referrers.length>0?e.jsx(_,{columnContentTypes:["text","text","numeric","numeric"],headings:["Member","Code","Referrals","Earnings"],rows:s.top_referrers.slice(0,5).filter(r=>r&&r.id!=null).map((r,u)=>[e.jsxs(c,{gap:"200",blockAlign:"center",children:[e.jsx(l,{tone:u===0?"success":u===1?"info":"enabled",children:`#${u+1}`}),e.jsxs(a,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:r.name||r.member_number||"Unknown"}),e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:r.email||"-"})]})]},r.id),e.jsx(l,{children:String(r.referral_code||"-")},`code-${r.id}`),r.referral_count||0,x(r.referral_earnings||0)])}):e.jsx(w,{heading:"No referrals yet",image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Top referrers will appear here once members start sharing."})})]})})}),e.jsx(p.Section,{variant:"oneHalf",children:e.jsx(h,{children:e.jsxs(a,{gap:"400",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Recent Activity"}),e.jsx(l,{children:"Latest signups"})]}),s?.recent_referrals&&s.recent_referrals.length>0?e.jsx(_,{columnContentTypes:["text","text","text"],headings:["New Member","Referred By","Joined"],rows:s.recent_referrals.slice(0,5).filter(r=>r&&r.id!=null).map(r=>[e.jsx(a,{gap:"050",children:e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:r.name||r.member_number||"Unknown"})},r.id),e.jsx(l,{tone:"info",children:String(r.referred_by||"Unknown")},`by-${r.id}`),r.created_at?k(r.created_at):"-"])}):e.jsx(w,{heading:"No recent referrals",image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Recent referral activity will appear here."})})]})})}),e.jsx(p.Section,{children:e.jsx(h,{children:e.jsxs(a,{gap:"400",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Promote Your Referral Program"}),e.jsxs(a,{gap:"200",children:[e.jsxs(c,{gap:"200",children:[e.jsx(l,{children:"1"}),e.jsxs(n,{as:"p",children:["Add the ",e.jsx("strong",{children:"Refer a Friend"})," theme block to your storefront"]})]}),e.jsxs(c,{gap:"200",children:[e.jsx(l,{children:"2"}),e.jsx(n,{as:"p",children:"Members can find their unique referral code in their account dashboard"})]}),e.jsxs(c,{gap:"200",children:[e.jsx(l,{children:"3"}),e.jsx(n,{as:"p",children:"New customers use the code at signup to unlock rewards for both parties"})]})]}),e.jsxs(c,{gap:"300",children:[e.jsx(v,{url:"/app/settings",children:"Customize Theme Blocks"}),e.jsx(v,{variant:"plain",children:"View Documentation"})]})]})})})]}),e.jsx(S,{open:d,onClose:()=>f(!1),title:"Configure Referral Rewards",primaryAction:{content:"Save Changes",onAction:()=>f(!1)},secondaryActions:[{content:"Cancel",onAction:()=>f(!1)}],children:e.jsx(S.Section,{children:e.jsxs(a,{gap:"400",children:[e.jsx(m,{tone:"info",children:e.jsx("p",{children:"Referral reward amounts are currently configured in the backend. Contact support to change these values."})}),e.jsx(j,{label:"Referrer Reward",type:"number",prefix:"$",value:i?.config.referrer_credit?.toString()||"10",helpText:"Credit given to the existing member who referred someone",autoComplete:"off",disabled:!0}),e.jsx(j,{label:"New Member Reward",type:"number",prefix:"$",value:i?.config.referee_credit?.toString()||"5",helpText:"Credit given to the new member who was referred",autoComplete:"off",disabled:!0}),e.jsx(P,{label:"Grant Rewards",options:[{label:"On Signup",value:"signup"},{label:"On First Purchase",value:"purchase"}],value:i?.config.grant_on_signup?"signup":"purchase",helpText:"When referral rewards are credited",disabled:!0}),e.jsx(j,{label:"Monthly Limit per Member",type:"number",value:i?.config.max_referrals_per_month?.toString()||"50",helpText:"Maximum referrals a single member can make per month",autoComplete:"off",disabled:!0})]})})})]}):e.jsx(g,{title:"Referral Program",children:e.jsx(m,{tone:"warning",children:e.jsx("p",{children:"No shop connected. Please install the app from the Shopify App Store."})})})}export{z as EmbeddedReferrals};
