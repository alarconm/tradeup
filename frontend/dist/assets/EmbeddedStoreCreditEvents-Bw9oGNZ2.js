import{b as qe,u as We,c as F,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as l}from"./vendor-router-CdtyvhQv.js";import{a as k,g as E}from"./index-D10Yqe92.js";import{c as He,u as Ue}from"./useShopifyData-D2lWwkSF.js";import{P as je,B as R,a0 as fe,v as Ge,L as ie,C as p,a as d,T as n,u as ne,h as m,I as A,a5 as ae,c as f,a6 as Qe,a9 as Je,b as re,D as ve,t as y,Z as Ke,W as Ye,E as Ve,M as I,e as z,g as v,f as oe,z as P,G as be,_ as C,O as Se,Y as U,$ as we,a1 as Xe}from"./vendor-polaris-1WqYVNpP.js";import{T as Ze}from"./vendor-appbridge-DL6abzKC.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";function et(){const[o,u]=l.useState(()=>{if(typeof window>"u")return{isMobile:!1,isTablet:!1};const c=window.innerWidth;return{isMobile:c<768,isTablet:c>=768&&c<1024}});return l.useEffect(()=>{const c=()=>{const x=window.innerWidth;u({isMobile:x<768,isTablet:x>=768&&x<1024})};return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),o}const tt=[{label:"Monday",value:"0"},{label:"Tuesday",value:"1"},{label:"Wednesday",value:"2"},{label:"Thursday",value:"3"},{label:"Friday",value:"4"},{label:"Saturday",value:"5"},{label:"Sunday",value:"6"}],Ce=[{label:"Never expires",value:""},{label:"30 days",value:"30"},{label:"60 days",value:"60"},{label:"90 days",value:"90"},{label:"180 days",value:"180"},{label:"1 year",value:"365"}];async function st(o){const u=await k(`${E()}/promotions/promotions`,o);if(!u.ok)throw new Error("Failed to fetch events");return{events:((await u.json()).promotions||[]).filter(b=>b.promo_type==="purchase_cashback"||b.promo_type==="trade_in_bonus")}}async function it(o,u){const c=await k(`${E()}/promotions/promotions`,o,{method:"POST",body:JSON.stringify(u)});if(!c.ok)throw new Error("Failed to create event");return c.json()}async function nt(o,u,c){const x=await k(`${E()}/promotions/promotions/${u}`,o,{method:"PUT",body:JSON.stringify(c)});if(!x.ok)throw new Error("Failed to update event");return x.json()}async function at(o,u){if(!(await k(`${E()}/promotions/promotions/${u}`,o,{method:"DELETE"})).ok)throw new Error("Failed to delete event")}async function rt(o,u,c){const x=new URLSearchParams({start_datetime:u,end_datetime:c}),b=await k(`${E()}/store_credit_events/sources?${x}`,o);if(!b.ok)throw new Error("Failed to fetch order sources");return b.json()}async function ot(o,u){const c=await k(`${E()}/store_credit_events/preview`,o,{method:"POST",body:JSON.stringify(u)});if(!c.ok)throw new Error("Failed to preview event");return c.json()}async function lt(o,u){const c=await k(`${E()}/store_credit_events/run`,o,{method:"POST",body:JSON.stringify(u)});if(!c.ok)throw new Error("Failed to run event");return c.json()}function gt({shop:o}){const u=qe(),{isMobile:c,isTablet:x}=et(),[b,Te]=l.useState(0),[ke,D]=l.useState(!1),[M,G]=l.useState(null),[Ee,N]=l.useState(!1),[Q,le]=l.useState(null),[De,$]=l.useState(!1),[S,O]=l.useState(null),[_,q]=l.useState(null),[de,J]=l.useState([]),[s,h]=l.useState({name:"",description:"",promo_type:"purchase_cashback",bonus_percent:10,starts_at:"",ends_at:"",daily_start_time:"",daily_end_time:"",active_days:[],product_tags_filter:[],collection_ids:[],tier_restriction:[],active:!0,credit_expiration_days:""}),[i,g]=l.useState({start_datetime:"",end_datetime:"",sources:[],credit_percent:10,include_authorized:!0,credit_expiration_days:"",collection_ids:[],product_tags:[]}),[K,ce]=l.useState(""),[Y,ue]=l.useState(""),[V,he]=l.useState(""),[X,pe]=l.useState(""),{data:w}=He(o),{data:j}=Ue(o),{data:Fe,isLoading:Ae}=We({queryKey:["scheduled-events",o],queryFn:()=>st(o),enabled:!!o}),Ie=l.useMemo(()=>{if(!w?.tags)return[];const t=(V||"").toLowerCase();return(t?w.tags.filter(a=>(a||"").toLowerCase().includes(t)):w.tags).filter(a=>a).map(a=>({value:a,label:a}))},[w,V]),Pe=l.useMemo(()=>{if(!j?.collections)return[];const t=(X||"").toLowerCase();return(t?j.collections.filter(a=>(a?.title||"").toLowerCase().includes(t)):j.collections).filter(a=>a?.title).map(a=>({value:a.id,label:a.title}))},[j,X]),Me=l.useMemo(()=>{if(!w?.tags)return[];const t=(K||"").toLowerCase();return(t?w.tags.filter(a=>(a||"").toLowerCase().includes(t)):w.tags).filter(a=>a).map(a=>({value:a,label:a}))},[w,K]),Oe=l.useMemo(()=>{if(!j?.collections)return[];const t=(Y||"").toLowerCase();return(t?j.collections.filter(a=>(a?.title||"").toLowerCase().includes(t)):j.collections).filter(a=>a?.title).map(a=>({value:a.id,label:a.title}))},[j,Y]),Z=F({mutationFn:t=>it(o,t),onSuccess:()=>{u.invalidateQueries({queryKey:["scheduled-events"]}),D(!1),W()}}),ee=F({mutationFn:({id:t,data:r})=>nt(o,t,r),onSuccess:()=>{u.invalidateQueries({queryKey:["scheduled-events"]}),D(!1),G(null),W()}}),me=F({mutationFn:t=>at(o,t),onSuccess:()=>{u.invalidateQueries({queryKey:["scheduled-events"]}),N(!1),le(null)}}),te=F({mutationFn:()=>rt(o,i.start_datetime,i.end_datetime),onSuccess:t=>J(t.sources)}),xe=F({mutationFn:()=>ot(o,{start_datetime:i.start_datetime,end_datetime:i.end_datetime,sources:i.sources,credit_percent:i.credit_percent,include_authorized:i.include_authorized,collection_ids:i.collection_ids.length>0?i.collection_ids:void 0,product_tags:i.product_tags.length>0?i.product_tags:void 0}),onSuccess:t=>{O(t),q(null)}}),_e=F({mutationFn:()=>lt(o,{start_datetime:i.start_datetime,end_datetime:i.end_datetime,sources:i.sources,credit_percent:i.credit_percent,include_authorized:i.include_authorized,expires_at:i.credit_expiration_days?new Date(Date.now()+parseInt(i.credit_expiration_days)*24*60*60*1e3).toISOString():void 0,collection_ids:i.collection_ids.length>0?i.collection_ids:void 0,product_tags:i.product_tags.length>0?i.product_tags:void 0}),onSuccess:t=>{q(t),O(null)}}),W=l.useCallback(()=>{const t=new Date,r=new Date(t.getTime()+10080*60*1e3);h({name:"",description:"",promo_type:"purchase_cashback",bonus_percent:10,starts_at:t.toISOString().slice(0,16),ends_at:r.toISOString().slice(0,16),daily_start_time:"",daily_end_time:"",active_days:[],product_tags_filter:[],collection_ids:[],tier_restriction:[],active:!0,credit_expiration_days:""}),he(""),pe("")},[]),se=l.useCallback(()=>{g({start_datetime:"",end_datetime:"",sources:[],credit_percent:10,include_authorized:!0,credit_expiration_days:"",collection_ids:[],product_tags:[]}),O(null),q(null),J([]),ce(""),ue("")},[]),T=l.useCallback(t=>{if(W(),t){const r=new Date,a=t.duration_hours?new Date(r.getTime()+t.duration_hours*60*60*1e3):new Date(r.getTime()+10080*60*1e3);h(L=>({...L,name:t.name,description:t.description,bonus_percent:t.bonus_percent,daily_start_time:t.daily_start_time||"",daily_end_time:t.daily_end_time||"",active_days:t.active_days||[],starts_at:r.toISOString().slice(0,16),ends_at:a.toISOString().slice(0,16)}))}G(null),D(!0)},[W]),Be=l.useCallback(t=>{G(t),h({name:t.name,description:t.description||"",promo_type:t.promo_type,bonus_percent:t.bonus_percent,starts_at:t.starts_at?.slice(0,16)||"",ends_at:t.ends_at?.slice(0,16)||"",daily_start_time:t.daily_start_time||"",daily_end_time:t.daily_end_time||"",active_days:t.active_days?t.active_days.split(","):[],product_tags_filter:t.product_tags_filter||[],collection_ids:t.collection_ids||[],tier_restriction:t.tier_restriction||[],active:t.active,credit_expiration_days:""}),D(!0)},[]),H=l.useCallback((t,r)=>{const a=new Date,L=t?new Date(a.getTime()+t*60*60*1e3):new Date(a.getTime()+10800*1e3);g({start_datetime:a.toISOString().slice(0,16),end_datetime:L.toISOString().slice(0,16),sources:[],credit_percent:r||10,include_authorized:!0,credit_expiration_days:"",collection_ids:[],product_tags:[]}),O(null),q(null),J([]),$(!0)},[]),ge=l.useCallback((t,r)=>{const a={...i,[t]:r};g(a),a.start_datetime&&a.end_datetime&&te.mutate()},[i,te]),Le=l.useCallback(()=>{const t={name:s.name,description:s.description||null,promo_type:s.promo_type,bonus_percent:s.bonus_percent,bonus_flat:0,multiplier:1,starts_at:s.starts_at,ends_at:s.ends_at,daily_start_time:s.daily_start_time||null,daily_end_time:s.daily_end_time||null,active_days:s.active_days.length>0?s.active_days.join(","):null,product_tags_filter:s.product_tags_filter.length>0?s.product_tags_filter:null,collection_ids:s.collection_ids.length>0?s.collection_ids:null,tier_restriction:s.tier_restriction.length>0?s.tier_restriction:null,channel:"all",stackable:!0,active:s.active,credit_expiration_days:s.credit_expiration_days?parseInt(s.credit_expiration_days):null};M?ee.mutate({id:M.id,data:t}):Z.mutate(t)},[s,M,Z,ee]),B=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),Re=t=>t.active?t.is_active_now?e.jsx(y,{tone:"success",children:"Active Now"}):t.starts_at&&new Date(t.starts_at)>new Date?e.jsx(y,{tone:"info",children:"Scheduled"}):e.jsx(y,{tone:"warning",children:"Ended"}):e.jsx(y,{children:"Disabled"}),ze=t=>{const r=[];if(t.daily_start_time&&t.daily_end_time&&r.push(`${t.daily_start_time} - ${t.daily_end_time}`),t.active_days){const a=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],L=t.active_days.split(",").map($e=>a[parseInt($e)]);r.push(L.join(", "))}return r.length>0?r.join(" on "):"All times"},Ne=[{id:"scheduled",content:"Live Promotions",panelID:"scheduled-panel"},{id:"bulk",content:"Post-Event Rewards",panelID:"bulk-panel"}];if(!o)return e.jsx(je,{title:"Store Credit Events",children:e.jsx(R,{tone:"warning",children:e.jsx("p",{children:"No shop connected. Please install the app from the Shopify App Store."})})});const ye=Fe?.events||[];return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{title:"Store Credit Events",children:e.jsx("button",{variant:"primary",onClick:()=>T(),children:"New Event"})}),e.jsxs(je,{title:"Store Credit Events",subtitle:"Create bonus events to reward customers with store credit",primaryAction:{content:"New Live Promotion",icon:Ge,onAction:()=>T()},secondaryActions:[{content:"Run Bulk Event",icon:fe,onAction:()=>H()}],children:[e.jsxs(ie,{children:[e.jsx(ie.Section,{children:e.jsx(p,{children:e.jsxs(d,{gap:"400",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Quick Start Templates"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Use a template to quickly create common bonus events"}),e.jsxs(ne,{columns:c?1:x?2:4,gap:"300",children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(d,{gap:"200",children:[e.jsxs(m,{gap:"200",blockAlign:"center",children:[e.jsx(A,{source:ae}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Black Friday"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"+10% store credit on all purchases during Black Friday weekend"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(f,{size:"slim",onClick:()=>T({name:"Black Friday Bonus",description:"Earn 10% store credit on all purchases this Black Friday weekend!",bonus_percent:10,duration_hours:72}),children:"Use Template"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(d,{gap:"200",children:[e.jsxs(m,{gap:"200",blockAlign:"center",children:[e.jsx(A,{source:Qe}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Trade Night"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Saturday 6-9pm bonus for in-store trades and purchases"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(f,{size:"slim",onClick:()=>T({name:"Saturday Trade Night",description:"Extra 10% store credit on Saturday evening purchases!",bonus_percent:10,daily_start_time:"18:00",daily_end_time:"21:00",active_days:["5"]}),children:"Use Template"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(d,{gap:"200",children:[e.jsxs(m,{gap:"200",blockAlign:"center",children:[e.jsx(A,{source:ae}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Weekend Warrior"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"+5% store credit on all weekend purchases"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(f,{size:"slim",onClick:()=>T({name:"Weekend Bonus",description:"Earn 5% store credit on all weekend purchases!",bonus_percent:5,active_days:["5","6"]}),children:"Use Template"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"140px"},children:[e.jsxs(d,{gap:"200",children:[e.jsxs(m,{gap:"200",blockAlign:"center",children:[e.jsx(A,{source:ae}),e.jsx(n,{as:"h4",variant:"headingSm",children:"Grand Opening"})]}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"+15% store credit on opening day purchases"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(f,{size:"slim",onClick:()=>T({name:"Grand Opening Bonus",description:"Celebrate our grand opening with 15% store credit!",bonus_percent:15,duration_hours:24}),children:"Use Template"})})]})})})]})]})})}),e.jsx(ie.Section,{children:e.jsxs(Je,{tabs:Ne,selected:b,onSelect:Te,children:[b===0&&e.jsx(p,{children:Ae?e.jsx(d,{gap:"400",children:[1,2,3].map(t=>e.jsx(re,{paddingBlock:"300",children:e.jsxs(m,{gap:"400",blockAlign:"center",children:[e.jsx(re,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"20px",minWidth:"150px"}),e.jsx(re,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"20px",minWidth:"100px"})]})},t))}):ye.length>0?e.jsx(ve,{columnContentTypes:["text","text","text","text","text","text"],headings:["Event Name","Bonus","Schedule","Date Range","Status","Actions"],rows:ye.map(t=>[e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",fontWeight:"semibold",children:t.name}),t.product_tags_filter&&t.product_tags_filter.length>0&&e.jsx(m,{gap:"100",children:t.product_tags_filter.slice(0,2).map(r=>e.jsx(y,{size:"small",children:r},r))})]},t.id),e.jsx(y,{tone:"success",children:`+${t.bonus_percent}%`},t.id),ze(t),e.jsxs(n,{as:"span",variant:"bodySm",children:[t.starts_at?new Date(t.starts_at).toLocaleDateString():"—"," - ",t.ends_at?new Date(t.ends_at).toLocaleDateString():"—"]},t.id),Re(t),e.jsxs(m,{gap:"200",children:[e.jsx(f,{size:"slim",icon:Ke,onClick:()=>Be(t),accessibilityLabel:`Edit ${t.name}`}),e.jsx(f,{size:"slim",icon:Ye,tone:"critical",onClick:()=>{le(t),N(!0)},accessibilityLabel:`Delete ${t.name}`})]},t.id)])}):e.jsx(Ve,{heading:"No live promotions yet",action:{content:"Create your first event",onAction:()=>T()},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Schedule store credit bonus events to reward your customers during special periods."})})}),b===1&&e.jsxs(d,{gap:"400",children:[e.jsx(p,{children:e.jsxs(d,{gap:"300",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Send Post-Event Rewards"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Issue store credit to customers based on their past orders. Great for rewarding customers after a busy sales period."}),e.jsxs(ne,{columns:c?1:x?2:3,gap:"300",children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"100px"},children:[e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Trade Night Recap"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Issue 10% credit for orders from the last 3 hours"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(f,{size:"slim",onClick:()=>H(3,10),children:"Run Event"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"100px"},children:[e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Weekend Recap"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Issue 5% credit for orders from the last 48 hours"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(f,{size:"slim",onClick:()=>H(48,5),children:"Run Event"})})]})})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsx(p,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:"100px"},children:[e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Custom Event"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Configure your own date range and credit percentage"})]}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px"},children:e.jsx(f,{size:"slim",variant:"primary",onClick:()=>H(),children:"Create Custom"})})]})})})]})]})}),e.jsx(p,{children:e.jsxs(d,{gap:"300",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"How Bulk Events Work"}),e.jsxs(d,{gap:"200",children:[e.jsxs(m,{gap:"200",blockAlign:"start",children:[e.jsx(y,{tone:"info",children:"1"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Set Date Range:"})," Choose the period to include orders from"]})]}),e.jsxs(m,{gap:"200",blockAlign:"start",children:[e.jsx(y,{tone:"info",children:"2"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Select Sources:"})," Filter by POS, Web, or all channels"]})]}),e.jsxs(m,{gap:"200",blockAlign:"start",children:[e.jsx(y,{tone:"info",children:"3"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Preview:"})," See exactly how much credit will be issued"]})]}),e.jsxs(m,{gap:"200",blockAlign:"start",children:[e.jsx(y,{tone:"success",children:"4"}),e.jsxs(n,{as:"p",variant:"bodySm",children:[e.jsx("strong",{children:"Apply:"})," Issue store credit to all qualifying customers"]})]})]})]})})]})]})})]}),e.jsx(I,{open:ke,onClose:()=>D(!1),title:M?"Edit Live Promotion":"New Live Promotion",primaryAction:{content:M?"Save Changes":"Create Event",onAction:Le,loading:Z.isPending||ee.isPending},secondaryActions:[{content:"Cancel",onAction:()=>D(!1)}],children:e.jsx(I.Section,{children:e.jsxs(z,{children:[e.jsx(v,{label:"Event Name",value:s.name,onChange:t=>h({...s,name:t}),autoComplete:"off",requiredIndicator:!0,placeholder:"e.g., Black Friday Bonus, Saturday Trade Night"}),e.jsx(v,{label:"Description",value:s.description,onChange:t=>h({...s,description:t}),multiline:2,autoComplete:"off",helpText:"Shown to customers in their account"}),e.jsx(oe,{label:"Bonus Type",options:[{label:"Purchase Cashback (% of order total)",value:"purchase_cashback"},{label:"Trade-In Bonus (% extra on trade-ins)",value:"trade_in_bonus"}],value:s.promo_type,onChange:t=>h({...s,promo_type:t})}),e.jsx(v,{label:"Bonus Percentage",type:"number",value:s.bonus_percent.toString(),onChange:t=>h({...s,bonus_percent:parseFloat(t)||0}),suffix:"%",autoComplete:"off",helpText:"Percentage of order/trade-in value to credit"}),e.jsx(P,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Date Range"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"The event will be active from start date through end date"}),e.jsxs(z.Group,{children:[e.jsx(v,{label:"Start Date",type:"date",value:s.starts_at.split("T")[0],onChange:t=>h({...s,starts_at:t+"T00:00"}),autoComplete:"off",requiredIndicator:!0}),e.jsx(v,{label:"End Date",type:"date",value:s.ends_at.split("T")[0],onChange:t=>h({...s,ends_at:t+"T23:59"}),autoComplete:"off",requiredIndicator:!0})]}),e.jsx(P,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Daily Time Window (Optional)"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Limit this bonus to specific hours each day (e.g., 6-9pm trade nights)"}),e.jsxs(z.Group,{children:[e.jsx(v,{label:"Daily Start Time",type:"time",value:s.daily_start_time,onChange:t=>h({...s,daily_start_time:t}),autoComplete:"off",helpText:"e.g., 18:00 for 6 PM"}),e.jsx(v,{label:"Daily End Time",type:"time",value:s.daily_end_time,onChange:t=>h({...s,daily_end_time:t}),autoComplete:"off",helpText:"e.g., 21:00 for 9 PM"})]}),e.jsx(be,{title:"Active Days",choices:tt,selected:s.active_days,onChange:t=>h({...s,active_days:t}),allowMultiple:!0}),e.jsx(P,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Product Filters (Optional)"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Only apply this bonus to specific products"}),e.jsxs(d,{gap:"200",children:[e.jsx(C,{options:Ie,selected:s.product_tags_filter,onSelect:t=>h({...s,product_tags_filter:t}),textField:e.jsx(C.TextField,{label:"Product Tags",value:V,onChange:he,placeholder:"e.g., pokemon, sports-cards",prefix:e.jsx(A,{source:Se}),autoComplete:"off"}),allowMultiple:!0}),s.product_tags_filter.length>0&&e.jsx(m,{gap:"100",wrap:!0,children:s.product_tags_filter.map(t=>e.jsx(U,{onRemove:()=>h({...s,product_tags_filter:s.product_tags_filter.filter(r=>r!==t)}),children:t},t))})]}),e.jsxs(d,{gap:"200",children:[e.jsx(C,{options:Pe,selected:s.collection_ids,onSelect:t=>h({...s,collection_ids:t}),textField:e.jsx(C.TextField,{label:"Collections",value:X,onChange:pe,placeholder:"Search collections...",prefix:e.jsx(A,{source:Se}),autoComplete:"off"}),allowMultiple:!0}),s.collection_ids.length>0&&e.jsx(m,{gap:"100",wrap:!0,children:s.collection_ids.map(t=>{const r=j?.collections?.find(a=>a?.id===t);return e.jsx(U,{onRemove:()=>h({...s,collection_ids:s.collection_ids.filter(a=>a!==t)}),children:r?.title||t},t)})})]}),e.jsx(P,{}),e.jsx(oe,{label:"Credit Expiration",options:Ce,value:s.credit_expiration_days,onChange:t=>h({...s,credit_expiration_days:t}),helpText:"How long before credited amounts expire"}),e.jsx(we,{label:"Event is active",checked:s.active,onChange:t=>h({...s,active:t})})]})})}),e.jsx(I,{open:Ee,onClose:()=>N(!1),title:"Delete Event",primaryAction:{content:"Delete",destructive:!0,onAction:()=>Q&&me.mutate(Q.id),loading:me.isPending},secondaryActions:[{content:"Cancel",onAction:()=>N(!1)}],children:e.jsx(I.Section,{children:e.jsxs(n,{as:"p",children:['Are you sure you want to delete "',Q?.name,'"? This action cannot be undone.']})})}),e.jsx(I,{open:De,onClose:()=>{$(!1),se()},title:"Run Bulk Store Credit Event",size:"large",primaryAction:S&&!_?{content:"Apply Credits",icon:fe,onAction:()=>_e.mutate(),loading:_e.isPending}:_?{content:"Done",onAction:()=>{$(!1),se()}}:{content:"Preview (Dry Run)",icon:Xe,onAction:()=>xe.mutate(),loading:xe.isPending,disabled:!i.start_datetime||!i.end_datetime||i.sources.length===0},secondaryActions:_?[]:[{content:"Cancel",onAction:()=>{$(!1),se()}}],children:e.jsx(I.Section,{children:_?e.jsxs(d,{gap:"400",children:[e.jsx(R,{title:_.success_count>0?"Event Completed Successfully!":"Event Completed",tone:_.failure_count>0?"warning":"success",children:e.jsxs("p",{children:["Issued ",B(_.total_credit_issued)," in store credit to ",_.success_count," customers.",_.failure_count>0&&` ${_.failure_count} failed.`]})}),_.errors&&_.errors.length>0&&e.jsx(p,{children:e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"h4",variant:"headingSm",tone:"critical",children:"Errors"}),_.errors.slice(0,10).map((t,r)=>e.jsx(n,{as:"p",variant:"bodySm",children:t},r))]})})]}):S?e.jsxs(d,{gap:"400",children:[e.jsx(R,{title:"Preview Results",tone:"info",children:e.jsx("p",{children:'This is a dry run. No credits have been issued yet. Review the data below and click "Apply Credits" to proceed.'})}),e.jsxs(ne,{columns:c||x?2:4,gap:"300",children:[e.jsx(p,{children:e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Total Orders"}),e.jsx(n,{as:"p",variant:"headingLg",children:S.summary.total_orders})]})}),e.jsx(p,{children:e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Unique Customers"}),e.jsx(n,{as:"p",variant:"headingLg",children:S.summary.unique_customers})]})}),e.jsx(p,{children:e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Total Order Value"}),e.jsx(n,{as:"p",variant:"headingLg",children:B(S.summary.total_order_value)})]})}),e.jsx(p,{children:e.jsxs(d,{gap:"100",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Credit to Issue"}),e.jsx(n,{as:"p",variant:"headingLg",tone:"success",children:B(S.summary.total_credit_to_issue)})]})})]}),S.top_customers&&S.top_customers.length>0&&e.jsx(p,{children:e.jsxs(d,{gap:"300",children:[e.jsx(n,{as:"h4",variant:"headingSm",children:"Top Customers by Credit"}),e.jsx(ve,{columnContentTypes:["text","text","numeric","numeric","numeric"],headings:["Customer","Email","Orders","Spent","Credit"],rows:S.top_customers.slice(0,5).map(t=>[t.name||"Guest",t.email||"-",t.order_count||0,B(t.total_spent||0),e.jsx(y,{tone:"success",children:B(t.credit_amount||0)},t.customer_id)])})]})}),e.jsx(f,{onClick:()=>O(null),variant:"plain",children:"Back to Edit"})]}):e.jsxs(z,{children:[e.jsx(R,{tone:"info",children:e.jsx("p",{children:'Reward customers for past purchases. Set your date range and filters, then click "Preview" to see who qualifies before sending credits.'})}),e.jsxs(z.Group,{children:[e.jsx(v,{label:"Start Date & Time",type:"datetime-local",value:i.start_datetime,onChange:t=>ge("start_datetime",t),autoComplete:"off",requiredIndicator:!0,helpText:"Include orders created after this time"}),e.jsx(v,{label:"End Date & Time",type:"datetime-local",value:i.end_datetime,onChange:t=>ge("end_datetime",t),autoComplete:"off",requiredIndicator:!0,helpText:"Include orders created before this time"})]}),e.jsx(v,{label:"Credit Percentage",type:"number",value:i.credit_percent.toString(),onChange:t=>g({...i,credit_percent:parseFloat(t)||0}),suffix:"%",autoComplete:"off",helpText:"Percentage of order total to issue as store credit"}),e.jsxs(d,{gap:"200",children:[e.jsxs(n,{as:"span",variant:"bodyMd",children:["Order Sources ",e.jsx(n,{as:"span",tone:"critical",children:"*"})]}),te.isPending?e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Loading available sources..."}):de.length>0?e.jsx(be,{title:"",choices:de.map(t=>({label:`${t.name} (${t.count} orders)`,value:t.name})),selected:i.sources,onChange:t=>g({...i,sources:t}),allowMultiple:!0}):i.start_datetime&&i.end_datetime?e.jsx(R,{tone:"warning",children:e.jsx("p",{children:"No orders found in this date range. Try adjusting the dates."})}):e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Select start and end dates to see available order sources."})]}),e.jsx(P,{}),e.jsx(n,{as:"h3",variant:"headingSm",children:"Product Filters (Optional)"}),e.jsx(n,{as:"p",variant:"bodySm",tone:"subdued",children:"Narrow down to orders containing specific products. Leave empty to include all orders."}),e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"span",variant:"bodyMd",children:"Collections"}),e.jsx(C,{options:Oe,selected:i.collection_ids,onSelect:t=>g({...i,collection_ids:t}),textField:e.jsx(C.TextField,{label:"",onChange:ue,value:Y,placeholder:"Search collections...",autoComplete:"off"}),allowMultiple:!0,listTitle:"Available Collections"}),i.collection_ids.length>0&&e.jsx(m,{gap:"100",wrap:!0,children:i.collection_ids.map(t=>{const r=j?.collections?.find(a=>a.id===t);return e.jsx(U,{onRemove:()=>g({...i,collection_ids:i.collection_ids.filter(a=>a!==t)}),children:r?.title||t},t)})})]}),e.jsxs(d,{gap:"200",children:[e.jsx(n,{as:"span",variant:"bodyMd",children:"Product Tags"}),e.jsx(C,{options:Me,selected:i.product_tags,onSelect:t=>g({...i,product_tags:t}),textField:e.jsx(C.TextField,{label:"",onChange:ce,value:K,placeholder:"Search tags...",autoComplete:"off"}),allowMultiple:!0,listTitle:"Available Tags"}),i.product_tags.length>0&&e.jsx(m,{gap:"100",wrap:!0,children:i.product_tags.map(t=>e.jsx(U,{onRemove:()=>g({...i,product_tags:i.product_tags.filter(r=>r!==t)}),children:t},t))})]}),e.jsx(P,{}),e.jsx(oe,{label:"Credit Expiration",options:Ce,value:i.credit_expiration_days,onChange:t=>g({...i,credit_expiration_days:t}),helpText:"How long before issued credits expire"}),e.jsx(we,{label:"Include authorized (unpaid) orders",checked:i.include_authorized,onChange:t=>g({...i,include_authorized:t})})]})})})]})]})}export{gt as EmbeddedStoreCreditEvents,gt as default};
