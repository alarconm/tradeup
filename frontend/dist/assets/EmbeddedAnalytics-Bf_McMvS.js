import{u as E,j as e}from"./vendor-query-Bq4hz6H9.js";import{r as v}from"./vendor-router-CdtyvhQv.js";import{g as A,a as W}from"./index-r9c0LRG1.js";import{P as g,B as S,b as C,h as r,l as I,L as x,C as t,T as n,f as F,u as R,a as i,t as j,z as _,o as $,D as M}from"./vendor-polaris-1WqYVNpP.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";function z(){const[o,m]=v.useState(()=>{if(typeof window>"u")return{isSmallMobile:!1,isMobile:!1,isTablet:!1};const d=window.innerWidth;return{isSmallMobile:d<480,isMobile:d<768,isTablet:d<1024}});return v.useEffect(()=>{const d=()=>{const h=window.innerWidth;m({isSmallMobile:h<480,isMobile:h<768,isTablet:h<1024})};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]),o}async function N(o,m){const d=await W(`${A()}/analytics/dashboard?period=${m}`,o);if(!d.ok)throw new Error("Failed to fetch analytics");return d.json()}function G({shop:o}){const{isSmallMobile:m,isMobile:d}=z(),[h,T]=v.useState("30"),{data:b,isLoading:k,error:L}=E({queryKey:["analytics",o,h],queryFn:()=>N(o,h),enabled:!!o}),c=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),l=s=>new Intl.NumberFormat("en-US").format(s),P=s=>`${s>=0?"+":""}${s.toFixed(1)}%`;if(!o)return e.jsx(g,{title:"Analytics",children:e.jsx(S,{tone:"warning",children:e.jsx("p",{children:"No shop connected. Please install the app from the Shopify App Store."})})});if(k)return e.jsx(g,{title:"Analytics",children:e.jsx(C,{padding:"1600",children:e.jsx(r,{align:"center",children:e.jsx(I,{size:"large"})})})});if(L)return e.jsx(g,{title:"Analytics",children:e.jsx(S,{tone:"critical",children:e.jsx("p",{children:"Failed to load analytics data. Please try refreshing the page."})})});const a=b?.overview||{total_members:0,active_members:0,new_members_this_month:0,member_growth_pct:0,total_trade_ins:0,trade_ins_this_month:0,trade_in_value_this_month:0,total_store_credit_issued:0,store_credit_this_month:0,total_referrals:0,referrals_this_month:0},y=b?.tier_distribution||[],f=b?.top_members||[],w=b?.category_performance||[],u=(s="summary")=>{const p=new URLSearchParams;p.set("type",s),p.set("period",h),o&&p.set("shop",o),window.open(`${A()}/analytics/export?${p.toString()}`,"_blank")};return e.jsx(g,{title:"Analytics",subtitle:"Track your loyalty program performance",primaryAction:{content:"Export Report",onAction:()=>u("summary")},secondaryActions:[{content:"Export Members",onAction:()=>u("members")},{content:"Export Trade-Ins",onAction:()=>u("trade_ins")},{content:"Export Credits",onAction:()=>u("credits")}],children:e.jsxs(x,{children:[e.jsx(x.Section,{children:e.jsx(t,{children:e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Reporting Period"}),e.jsx(F,{label:"",labelHidden:!0,options:[{label:"Last 7 days",value:"7"},{label:"Last 30 days",value:"30"},{label:"Last 90 days",value:"90"},{label:"Last 12 months",value:"365"},{label:"All time",value:"all"}],value:h,onChange:T})]})})}),e.jsx(x.Section,{children:e.jsxs(R,{columns:m?1:d?2:4,gap:d?"300":"400",children:[e.jsx(t,{children:e.jsxs(i,{gap:"300",children:[e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Members"}),e.jsx(j,{tone:a.member_growth_pct>=0?"success":"critical",children:P(a.member_growth_pct)})]}),e.jsx(n,{as:"p",variant:"heading2xl",children:l(a.total_members)}),e.jsx(_,{}),e.jsxs(r,{gap:"400",children:[e.jsxs(i,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Active"}),e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:l(a.active_members)})]}),e.jsxs(i,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"New This Month"}),e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:l(a.new_members_this_month)})]})]})]})}),e.jsx(t,{children:e.jsxs(i,{gap:"300",children:[e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Trade-Ins"}),e.jsx(j,{tone:"info",children:"This Period"})]}),e.jsx(n,{as:"p",variant:"heading2xl",children:l(a.trade_ins_this_month)}),e.jsx(_,{}),e.jsxs(r,{gap:"400",children:[e.jsxs(i,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Total Value"}),e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:c(a.trade_in_value_this_month)})]}),e.jsxs(i,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"All Time"}),e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:l(a.total_trade_ins)})]})]})]})}),e.jsx(t,{children:e.jsxs(i,{gap:"300",children:[e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Store Credit"}),e.jsx(j,{tone:"success",children:"Issued"})]}),e.jsx(n,{as:"p",variant:"heading2xl",children:c(a.store_credit_this_month)}),e.jsx(_,{}),e.jsxs(r,{gap:"400",children:[e.jsxs(i,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"This Month"}),e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:c(a.store_credit_this_month)})]}),e.jsxs(i,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"All Time"}),e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:c(a.total_store_credit_issued)})]})]})]})}),e.jsx(t,{children:e.jsxs(i,{gap:"300",children:[e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Referrals"}),e.jsx(j,{children:"Word of Mouth"})]}),e.jsx(n,{as:"p",variant:"heading2xl",children:l(a.referrals_this_month)}),e.jsx(_,{}),e.jsxs(r,{gap:"400",children:[e.jsxs(i,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"This Month"}),e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:l(a.referrals_this_month)})]}),e.jsxs(i,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"All Time"}),e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:l(a.total_referrals)})]})]})]})})]})}),e.jsx(x.Section,{variant:"oneHalf",children:e.jsx(t,{children:e.jsxs(i,{gap:"400",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Tier Distribution"}),y.length>0?e.jsx(i,{gap:"300",children:y.filter(s=>s&&s.tier_name).map(s=>e.jsxs(i,{gap:"100",children:[e.jsxs(r,{align:"space-between",children:[e.jsx(n,{as:"span",variant:"bodyMd",children:s.tier_name||"Unknown"}),e.jsxs(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:[l(s.member_count)," (",(s.percentage||0).toFixed(1),"%)"]})]}),e.jsx($,{progress:s.percentage,size:"small",tone:"primary"})]},s.tier_name||"unknown"))}):e.jsx(n,{as:"p",tone:"subdued",children:"No tier data available"})]})})}),e.jsx(x.Section,{variant:"oneHalf",children:e.jsx(t,{children:e.jsxs(i,{gap:"400",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Category Performance"}),w.length>0?e.jsx(M,{columnContentTypes:["text","numeric","numeric","numeric"],headings:["Category","Trade-Ins","Total Value","Avg Value"],rows:w.slice(0,5).filter(s=>s&&s.category_name).map(s=>[s.category_name||"Unknown",l(s.trade_in_count||0),c(s.total_value||0),c(s.avg_value||0)])}):e.jsx(n,{as:"p",tone:"subdued",children:"No category data available"})]})})}),e.jsx(x.Section,{children:e.jsx(t,{children:e.jsxs(i,{gap:"400",children:[e.jsxs(r,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Top Performing Members"}),e.jsx(j,{tone:"success",children:"VIPs"})]}),f.length>0?e.jsx(M,{columnContentTypes:["text","numeric","numeric","numeric"],headings:["Member","Trade-Ins","Credit Earned","Referrals"],rows:f.slice(0,10).filter(s=>s&&s.id!=null).map(s=>[e.jsxs(i,{gap:"050",children:[e.jsx(n,{as:"span",variant:"bodyMd",fontWeight:"semibold",children:s.name||s.member_number||"Unknown"}),e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:s.member_number||"-"})]},s.id),l(s.total_trade_ins||0),c(s.total_credit_earned||0),l(s.referral_count||0)])}):e.jsx(n,{as:"p",tone:"subdued",children:"No member data available"})]})})}),e.jsx(x.Section,{children:e.jsx(t,{children:e.jsxs(i,{gap:"400",children:[e.jsx(n,{as:"h3",variant:"headingMd",children:"Quick Insights"}),e.jsxs(r,{gap:"400",wrap:!0,children:[e.jsx(t,{children:e.jsxs(i,{gap:"200",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Avg Trade-In Value"}),e.jsx(n,{as:"span",variant:"headingLg",children:a.trade_ins_this_month>0?c(a.trade_in_value_this_month/a.trade_ins_this_month):"$0.00"})]})}),e.jsx(t,{children:e.jsxs(i,{gap:"200",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Member Retention"}),e.jsx(n,{as:"span",variant:"headingLg",children:a.total_members>0?`${(a.active_members/a.total_members*100).toFixed(1)}%`:"0%"})]})}),e.jsx(t,{children:e.jsxs(i,{gap:"200",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Credit per Member"}),e.jsx(n,{as:"span",variant:"headingLg",children:a.total_members>0?c(a.total_store_credit_issued/a.total_members):"$0.00"})]})}),e.jsx(t,{children:e.jsxs(i,{gap:"200",children:[e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:"Referral Rate"}),e.jsx(n,{as:"span",variant:"headingLg",children:a.total_members>0?`${(a.total_referrals/a.total_members*100).toFixed(1)}%`:"0%"})]})})]})]})})})]})})}export{G as EmbeddedAnalytics};
