import{b as F,u as C,c as z,j as e}from"./vendor-query-Bq4hz6H9.js";import{u as A,r as v}from"./vendor-router-CdtyvhQv.js";import{a as w,g as k}from"./index-B6-oWjXE.js";import{C as g,a as d,T as a,b as u,h as x,c as M,m as B,n as q,o as T,B as j,p as K,q as H,I as $,r as U,s as W,t as y,P as S,L as h,u as E,l as N,D as O,E as Q}from"./vendor-polaris-1WqYVNpP.js";import"./vendor-react-N--QU9DW.js";import"./vendor-sentry-UzNpYtBG.js";import"./vendor-appbridge-DL6abzKC.js";async function Y(s){const r=await w(`${k()}/setup/status`,s);if(!r.ok)throw new Error("Failed to fetch setup status");return r.json()}async function G(s,r){if(!(await w(`${k()}/setup/milestones/${r}/celebrate`,s,{method:"POST"})).ok)throw new Error("Failed to mark milestone as celebrated")}function V({shop:s,compact:r=!1,onMilestoneShow:t}){const p=A(),l=F(),[n,_]=v.useState(!r),[b,m]=v.useState(null),{data:o,isLoading:f}=C({queryKey:["setup-status",s],queryFn:()=>Y(s),enabled:!!s,staleTime:3e4}),i=z({mutationFn:c=>G(s,c),onSuccess:()=>{l.invalidateQueries({queryKey:["setup-status",s]})}});v.useEffect(()=>{if(o?.uncelebrated_milestones&&o.uncelebrated_milestones.length>0){const c=o.uncelebrated_milestones[0];m(c),t&&t(c)}},[o?.uncelebrated_milestones,t]);const L=()=>{b&&(i.mutate(b.id),m(null))};if(f||!o)return e.jsx(g,{children:e.jsxs(d,{gap:"400",children:[e.jsx(a,{as:"h3",variant:"headingMd",children:"Setup Progress"}),e.jsx(u,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"8px"}),e.jsx(u,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"40px"})]})});if(o.completion.all_complete&&r)return null;const R=o.checklist.filter(c=>c.category==="setup"),I=o.checklist.filter(c=>c.category==="milestone"),P=c=>c===100?"success":c>=60?"highlight":"primary";return e.jsx(g,{children:e.jsxs(d,{gap:"400",children:[e.jsxs(x,{align:"space-between",blockAlign:"center",children:[e.jsxs(d,{gap:"100",children:[e.jsx(a,{as:"h3",variant:"headingMd",children:o.completion.all_complete?"Setup Complete!":"Setup Progress"}),e.jsxs(a,{as:"p",variant:"bodySm",tone:"subdued",children:[o.completion.setup_completed," of ",o.completion.setup_total," steps completed"]})]}),e.jsxs(x,{gap:"200",blockAlign:"center",children:[e.jsxs(a,{as:"span",variant:"headingLg",fontWeight:"bold",children:[o.completion.setup_percentage,"%"]}),r&&e.jsx(M,{variant:"plain",onClick:()=>_(!n),icon:n?B:q,accessibilityLabel:n?"Collapse":"Expand"})]})]}),e.jsx(T,{progress:o.completion.setup_percentage,size:"small",tone:P(o.completion.setup_percentage)}),b&&e.jsx(j,{title:b.title,tone:"success",onDismiss:L,icon:K,children:e.jsx("p",{children:b.message})}),e.jsx(H,{open:n||!r,id:"setup-checklist",children:e.jsxs(d,{gap:"300",children:[R.map(c=>e.jsx(D,{item:c,onAction:()=>p(c.action_url)},c.id)),!r&&I.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(u,{paddingBlockStart:"200",children:e.jsx(a,{as:"h4",variant:"headingSm",tone:"subdued",children:"Milestones"})}),I.map(c=>e.jsx(D,{item:c,onAction:()=>p(c.action_url),isMilestone:!0},c.id))]})]})}),!o.completion.all_complete&&o.next_action&&r&&!n&&e.jsx(u,{paddingBlockStart:"200",children:e.jsx(M,{variant:"primary",onClick:()=>p(o.next_action.action_url),children:o.next_action.action_label})})]})})}function D({item:s,onAction:r,isMilestone:t=!1}){return e.jsx(u,{paddingBlock:"200",paddingInline:"100",borderRadius:"200",background:s.completed?"bg-surface-success":void 0,children:e.jsxs(x,{align:"space-between",blockAlign:"center",gap:"400",children:[e.jsxs(x,{gap:"300",blockAlign:"center",children:[e.jsx(u,{children:e.jsx($,{source:s.completed?U:W,tone:s.completed?"success":"subdued"})}),e.jsxs(d,{gap:"050",children:[e.jsxs(x,{gap:"200",blockAlign:"center",children:[e.jsx(a,{as:"span",variant:"bodyMd",fontWeight:s.completed?"regular":"semibold",tone:s.completed?"subdued":void 0,children:s.title}),s.fully_complete===!1&&s.completed&&e.jsx(y,{tone:"attention",children:"Partial"}),t&&s.completed&&e.jsx(y,{tone:"success",children:"Achieved"})]}),e.jsx(a,{as:"span",variant:"bodySm",tone:"subdued",children:s.description})]})]}),!s.completed&&e.jsx(M,{size:"slim",onClick:r,children:s.action_label})]})})}async function J(s){const r=await w(`${k()}/dashboard/stats`,s);if(!r.ok)throw new Error("Failed to fetch dashboard");return r.json()}async function X(s){const r=await w(`${k()}/dashboard/activity`,s);if(!r.ok)throw new Error("Failed to fetch activity");return r.json()}function Z(){const[s,r]=v.useState(()=>{if(typeof window>"u")return{isSmallMobile:!1,isMobile:!1,isTablet:!1};const t=window.innerWidth;return{isSmallMobile:t<480,isMobile:t<768,isTablet:t<1024}});return v.useEffect(()=>{const t=()=>{const p=window.innerWidth;r({isSmallMobile:p<480,isMobile:p<768,isTablet:p<1024})};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),s}function oe({shop:s}){const{isSmallMobile:r,isMobile:t,isTablet:p}=Z(),l=A(),{data:n,isLoading:_,error:b}=C({queryKey:["dashboard",s],queryFn:()=>J(s),enabled:!!s,staleTime:3e4,gcTime:6e4}),{data:m,isLoading:o}=C({queryKey:["activity",s],queryFn:()=>X(s),enabled:!!s,staleTime:3e4,gcTime:6e4});if(!s)return e.jsx(S,{title:"Dashboard",children:e.jsx(j,{tone:"warning",children:e.jsx("p",{children:"No shop connected. Please install the app from the Shopify App Store."})})});if(_)return e.jsx(S,{title:"Dashboard",subtitle:"Loading your membership program data...",children:e.jsxs(h,{children:[e.jsx(h.Section,{children:e.jsx(E,{columns:r?1:t||p?2:4,gap:t?"300":"400",children:[1,2,3,4].map(i=>e.jsx(g,{children:e.jsxs(d,{gap:"200",children:[e.jsx(u,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"20px"}),e.jsx(u,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"40px"}),e.jsx(u,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"20px",maxWidth:"60px"})]})},i))})}),e.jsx(h.Section,{variant:"oneThird",children:e.jsx(g,{children:e.jsxs(d,{gap:"400",children:[e.jsx(u,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"24px"}),e.jsx(u,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"40px"}),e.jsx(u,{background:"bg-surface-secondary",borderRadius:"100",minHeight:"40px"})]})})})]})});if(b)return e.jsx(S,{title:"Dashboard",children:e.jsx(j,{tone:"critical",children:e.jsx("p",{children:"Failed to load dashboard data. Please try refreshing the page."})})});const f=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(i);return e.jsx(S,{title:"Dashboard",subtitle:"Welcome back! Here's how your membership program is performing.",children:e.jsxs(h,{children:[n?.subscription&&!n.subscription.active&&e.jsx(h.Section,{children:e.jsx(j,{title:"Subscription Required",action:{content:"Choose a Plan",url:"/app/billing"},tone:"warning",children:e.jsx("p",{children:"Start your free trial to unlock all TradeUp features."})})}),n?.membership_products_draft&&e.jsx(h.Section,{children:e.jsx(j,{title:"Membership Products in Draft Mode",action:{content:"Complete Setup",onAction:()=>l("/app/products/wizard")},tone:"warning",children:e.jsxs("p",{children:["Your ",n.membership_products_count||0," membership product",(n.membership_products_count||0)!==1?"s are":" is"," not visible to customers yet. Publish them when you're ready to start selling memberships."]})})}),n?.product_wizard_in_progress&&!n?.membership_products_draft&&e.jsx(h.Section,{children:e.jsx(j,{title:"Product Setup Incomplete",action:{content:"Resume Setup",onAction:()=>l("/app/products/wizard")},tone:"info",children:e.jsx("p",{children:"You have an unfinished product setup. Continue where you left off."})})}),e.jsx(h.Section,{children:e.jsx(V,{shop:s,compact:!0})}),e.jsx(h.Section,{children:e.jsxs(E,{columns:r?1:t||p?2:4,gap:t?"300":"400",children:[e.jsx("div",{onClick:()=>l("/app/members"),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&l("/app/members"),children:e.jsx(g,{children:e.jsxs(d,{gap:"200",children:[e.jsx(a,{as:"h3",variant:t?"headingSm":"headingMd",children:"Total Members"}),e.jsx(a,{as:"p",variant:t?"headingLg":"heading2xl",children:n?.total_members||0}),e.jsx(y,{tone:"success",children:`${n?.active_members??0} active`})]})})}),e.jsx("div",{onClick:()=>l("/app/trade-ins"),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&l("/app/trade-ins"),children:e.jsx(g,{children:e.jsxs(d,{gap:"200",children:[e.jsx(a,{as:"h3",variant:t?"headingSm":"headingMd",children:"Trade-Ins"}),e.jsx(a,{as:"p",variant:t?"headingLg":"heading2xl",children:n?.completed_trade_ins||0}),e.jsx(y,{tone:"attention",children:`${n?.pending_trade_ins??0} pending`})]})})}),e.jsx("div",{onClick:()=>l("/app/trade-ins"),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&l("/app/trade-ins"),children:e.jsx(g,{children:e.jsxs(d,{gap:"200",children:[e.jsx(a,{as:"h3",variant:t?"headingSm":"headingMd",children:"Total Value"}),e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(a,{as:"p",variant:t||p?"headingLg":"heading2xl",children:f(n?.total_trade_in_value||0)})}),e.jsx(a,{as:"p",variant:"bodySm",tone:"subdued",children:"Trade-in value processed"})]})})}),e.jsx("div",{onClick:()=>l("/app/members"),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&l("/app/members"),children:e.jsx(g,{children:e.jsxs(d,{gap:"200",children:[e.jsx(a,{as:"h3",variant:t?"headingSm":"headingMd",children:"Credits Issued"}),e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(a,{as:"p",variant:t||p?"headingLg":"heading2xl",children:f(n?.total_credits_issued||0)})}),e.jsx(a,{as:"p",variant:"bodySm",tone:"subdued",children:"Store credit distributed"})]})})})]})}),e.jsx(h.Section,{variant:"oneThird",children:e.jsx(g,{children:e.jsxs(d,{gap:"400",children:[e.jsxs(x,{align:"space-between",children:[e.jsx(a,{as:"h3",variant:"headingMd",children:"Current Plan"}),e.jsx(y,{tone:"info",children:String(n?.subscription?.plan||"Free")})]}),e.jsx("div",{onClick:()=>l("/app/members"),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&l("/app/members"),children:e.jsxs(d,{gap:"200",children:[e.jsxs(x,{align:"space-between",children:[e.jsx(a,{as:"span",variant:"bodySm",children:"Members"}),e.jsxs(a,{as:"span",variant:"bodySm",children:[n?.subscription?.usage?.members?.current||0," /"," ",n?.subscription?.usage?.members?.limit===null?"∞":n?.subscription?.usage?.members?.limit]})]}),e.jsx(T,{progress:n?.subscription?.usage?.members?.percentage||0,size:"small",tone:(n?.subscription?.usage?.members?.percentage||0)>90?"critical":(n?.subscription?.usage?.members?.percentage||0)>75?"highlight":"success"})]})}),e.jsx("div",{onClick:()=>l("/app/tiers"),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&l("/app/tiers"),children:e.jsxs(d,{gap:"200",children:[e.jsxs(x,{align:"space-between",children:[e.jsx(a,{as:"span",variant:"bodySm",children:"Tiers"}),e.jsxs(a,{as:"span",variant:"bodySm",children:[n?.subscription?.usage?.tiers?.current||0," /"," ",n?.subscription?.usage?.tiers?.limit===null?"∞":n?.subscription?.usage?.tiers?.limit]})]}),e.jsx(T,{progress:n?.subscription?.usage?.tiers?.percentage||0,size:"small"})]})})]})})}),e.jsx(h.Section,{children:e.jsx(g,{children:e.jsxs(d,{gap:"400",children:[e.jsx(a,{as:"h3",variant:"headingMd",children:"Recent Activity"}),o?e.jsx(N,{size:"small"}):m&&m.length>0?e.jsx(O,{columnContentTypes:["text","text","text","numeric"],headings:["Type","Member","Description","Amount"],rows:m.slice(0,5).filter(i=>i&&i.id!=null).map(i=>[e.jsx(y,{tone:i.type==="trade_in"?"success":"info",children:String(i.type==="trade_in"?"Trade-In":i.type||"Activity")},i.id),i.member_name||"Unknown",i.description||"-",f(i.amount||0)])}):e.jsx(Q,{heading:"No activity yet",image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Activity will appear here once members start using the trade-in program."})})]})})}),e.jsx(h.Section,{children:e.jsx(u,{paddingBlockStart:"400",children:e.jsx(a,{as:"p",variant:"bodySm",tone:"subdued",alignment:"center",children:"Build: 2026-01-10-v1"})})})]})})}export{oe as EmbeddedDashboard};
