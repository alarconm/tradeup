(()=>{var M=Object.defineProperty;var x=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var A=(s,_,n)=>_ in s?M(s,_,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[_]=n,B=(s,_)=>{for(var n in _||(_={}))R.call(_,n)&&A(s,n,_[n]);if(x)for(var n of x(_))j.call(_,n)&&A(s,n,_[n]);return s};var F=(s,_,n)=>new Promise((E,h)=>{var w=l=>{try{D(n.next(l))}catch(g){h(g)}},P=l=>{try{D(n.throw(l))}catch(g){h(g)}},D=l=>l.done?E(l.value):Promise.resolve(l.value).then(w,P);D((n=n.apply(s,_)).next())});var V="WebPixel::Render";var k=s=>shopify.extend(V,s);k(({analytics:s,browser:_,settings:n,init:E})=>{var I,N;let h=n.endpoint_url||"https://app.cardflowlabs.com/api/analytics/pixel",w=n.debug_mode===!0,P=n.enable_checkout_tracking!==!1,D=n.enable_page_tracking!==!1,l="tradeup",g=((N=(I=E.data)==null?void 0:I.shop)==null?void 0:N.domain)||"",b=(t,e)=>F(null,null,function*(){let r=B({event:t,timestamp:new Date().toISOString(),shop:g},e);w&&console.log(`[TradeUp Pixel] ${t}:`,r);try{let a=JSON.stringify(r);if(navigator.sendBeacon){let i=new Blob([a],{type:"application/json"});navigator.sendBeacon(h,i)}else fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:a,keepalive:!0}).catch(()=>{})}catch(a){w&&console.error("[TradeUp Pixel] Error:",a)}}),T=t=>{if(!t)return{};let e={};if(t.metafields)for(let r of t.metafields)r.namespace===l&&(e[r.key]=r.value);return e},L=(t,e)=>{var d;let r=parseFloat(((d=t.totalPrice)==null?void 0:d.amount)||0),a=parseFloat(e.points_multiplier||1),i=parseFloat(e.tier_bonus||0),o=Math.floor(r*a),c=Math.floor(o*(i/100));return{base:o,bonus:c,total:o+c}};P&&(s.subscribe("checkout_completed",t=>{var o,c,d,u,m,p,f;let e=(o=t.data)==null?void 0:o.checkout;if(!e)return;let r=e.customer,a=T(r),i=L(e,a);b("tradeup_points_earned",{order_id:(c=e.order)==null?void 0:c.id,order_number:(d=e.order)==null?void 0:d.name,customer_id:r==null?void 0:r.id,customer_email:r==null?void 0:r.email,order_value:parseFloat(((u=e.totalPrice)==null?void 0:u.amount)||0),currency:((m=e.totalPrice)==null?void 0:m.currencyCode)||"USD",points_earned:i.total,points_base:i.base,points_bonus:i.bonus,tier:a.tier_name||null,tier_id:a.tier_id||null,is_member:!!a.member_id,member_id:a.member_id||null,item_count:((p=e.lineItems)==null?void 0:p.length)||0,discount_codes:((f=e.discountCodes)==null?void 0:f.map(y=>y.code))||[]})}),s.subscribe("checkout_started",t=>{var i,o,c,d;let e=(i=t.data)==null?void 0:i.checkout;if(!e)return;let r=e.customer,a=T(r);a.member_id&&b("tradeup_checkout_started",{checkout_id:e.token,customer_id:r==null?void 0:r.id,member_id:a.member_id,tier:a.tier_name||null,cart_value:parseFloat(((o=e.totalPrice)==null?void 0:o.amount)||0),currency:((c=e.totalPrice)==null?void 0:c.currencyCode)||"USD",item_count:((d=e.lineItems)==null?void 0:d.length)||0})})),D&&s.subscribe("page_viewed",t=>{var o,c,d,u,m,p;let e=t.context,r=((c=(o=e==null?void 0:e.document)==null?void 0:o.location)==null?void 0:c.href)||"",a=((u=(d=e==null?void 0:e.document)==null?void 0:d.location)==null?void 0:u.pathname)||"";(a.includes("/account")||a.includes("/rewards")||a.includes("/loyalty")||a.includes("/points")||r.includes("tradeup"))&&b("tradeup_reward_viewed",{page_url:r,page_path:a,page_title:((m=e==null?void 0:e.document)==null?void 0:m.title)||"",referrer:((p=e==null?void 0:e.document)==null?void 0:p.referrer)||""})}),s.subscribe("tradeup_tier_displayed",t=>{var e,r,a,i,o,c,d,u;b("tradeup_tier_displayed",{tier_name:(e=t.customData)==null?void 0:e.tier_name,tier_id:(r=t.customData)==null?void 0:r.tier_id,member_id:(a=t.customData)==null?void 0:a.member_id,points_balance:(i=t.customData)==null?void 0:i.points_balance,credit_balance:(o=t.customData)==null?void 0:o.credit_balance,page_url:(u=(d=(c=t.context)==null?void 0:c.document)==null?void 0:d.location)==null?void 0:u.href})}),s.subscribe("tradeup_reward_redeemed",t=>{var e,r,a,i,o,c,d;b("tradeup_reward_redeemed",{reward_id:(e=t.customData)==null?void 0:e.reward_id,reward_name:(r=t.customData)==null?void 0:r.reward_name,reward_type:(a=t.customData)==null?void 0:a.reward_type,points_spent:(i=t.customData)==null?void 0:i.points_spent,reward_value:(o=t.customData)==null?void 0:o.reward_value,member_id:(c=t.customData)==null?void 0:c.member_id,customer_id:(d=t.customData)==null?void 0:d.customer_id})}),s.subscribe("tradeup_referral_shared",t=>{var e,r,a,i,o,c,d;b("tradeup_referral_shared",{referral_code:(e=t.customData)==null?void 0:e.referral_code,share_method:(r=t.customData)==null?void 0:r.share_method,member_id:(a=t.customData)==null?void 0:a.member_id,customer_id:(i=t.customData)==null?void 0:i.customer_id,page_url:(d=(c=(o=t.context)==null?void 0:o.document)==null?void 0:c.location)==null?void 0:d.href})}),s.subscribe("tradeup_member_enrolled",t=>{var e,r,a,i,o;b("tradeup_member_enrolled",{member_id:(e=t.customData)==null?void 0:e.member_id,customer_id:(r=t.customData)==null?void 0:r.customer_id,tier_name:(a=t.customData)==null?void 0:a.tier_name,referral_code:(i=t.customData)==null?void 0:i.referral_code,signup_source:(o=t.customData)==null?void 0:o.signup_source})}),s.subscribe("product_viewed",t=>{var a,i,o,c,d,u,m,p,f,y,S,U,C;let e=(i=(a=t.data)==null?void 0:a.productVariant)==null?void 0:i.product;if(!e)return;((o=e.metafields)==null?void 0:o.some(O=>O.namespace===l&&O.key==="trade_in_eligible"))&&b("tradeup_trade_in_product_viewed",{product_id:e.id,product_title:e.title,product_type:e.type,product_vendor:e.vendor,variant_id:(d=(c=t.data)==null?void 0:c.productVariant)==null?void 0:d.id,variant_title:(m=(u=t.data)==null?void 0:u.productVariant)==null?void 0:m.title,price:parseFloat(((y=(f=(p=t.data)==null?void 0:p.productVariant)==null?void 0:f.price)==null?void 0:y.amount)||0),currency:((C=(U=(S=t.data)==null?void 0:S.productVariant)==null?void 0:U.price)==null?void 0:C.currencyCode)||"USD"})}),s.subscribe("product_added_to_cart",t=>{var r,a,i,o,c,d,u,m,p,f;let e=(r=t.data)==null?void 0:r.cartLine;e&&b("tradeup_cart_add",{product_id:(i=(a=e.merchandise)==null?void 0:a.product)==null?void 0:i.id,product_title:(c=(o=e.merchandise)==null?void 0:o.product)==null?void 0:c.title,variant_id:(d=e.merchandise)==null?void 0:d.id,quantity:e.quantity,price:parseFloat(((m=(u=e.cost)==null?void 0:u.totalAmount)==null?void 0:m.amount)||0),currency:((f=(p=e.cost)==null?void 0:p.totalAmount)==null?void 0:f.currencyCode)||"USD"})}),w&&console.log("[TradeUp Pixel] Initialized",{endpoint:h,shop:g,checkout_tracking:P,page_tracking:D})});})();
