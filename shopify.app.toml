# Cardflow Labs - TradeUp Shopify App Configuration
# https://shopify.dev/docs/apps/tools/cli/configuration
#
# TradeUp: Store Credit, Rewards & Membership for Shopify
# https://cardflowlabs.com

name = "TradeUp by Cardflow Labs"
client_id = "f27841c5cf965100dfa81a212d7d9c10"

[access_scopes]
scopes = "read_customers,write_customers,read_orders,read_products,write_products,read_inventory,read_fulfillments"

[auth]
redirect_urls = [
  "https://cardflowlabs.com/api/shopify/callback",
  "https://app.cardflowlabs.com/api/shopify/callback",
  "https://localhost:3000/api/shopify/callback"
]

[webhooks]
api_version = "2024-10"

  # Customer lifecycle webhooks - rewards enrollment & sync
  [[webhooks.subscriptions]]
  topics = ["customers/create"]
  uri = "/webhook/customers/create"

  [[webhooks.subscriptions]]
  topics = ["customers/update"]
  uri = "/webhook/customers/update"

  [[webhooks.subscriptions]]
  topics = ["customers/delete"]
  uri = "/webhook/customers/delete"

  # Order lifecycle webhooks - points & rewards
  [[webhooks.subscriptions]]
  topics = ["orders/create"]
  uri = "/webhook/orders/create"

  [[webhooks.subscriptions]]
  topics = ["orders/paid"]
  uri = "/webhook/orders/paid"

  [[webhooks.subscriptions]]
  topics = ["orders/cancelled"]
  uri = "/webhook/orders/cancelled"

  [[webhooks.subscriptions]]
  topics = ["orders/fulfilled"]
  uri = "/webhook/orders/fulfilled"

  [[webhooks.subscriptions]]
  topics = ["refunds/create"]
  uri = "/webhook/refunds/create"

  # Product webhooks - trade-in tracking
  [[webhooks.subscriptions]]
  topics = ["products/create"]
  uri = "/webhook/products/create"

  # App lifecycle webhooks
  [[webhooks.subscriptions]]
  topics = ["app/uninstalled"]
  uri = "/webhook/app/uninstalled"

  [[webhooks.subscriptions]]
  topics = ["shop/update"]
  uri = "/webhook/shop/update"

  # Billing webhooks
  [[webhooks.subscriptions]]
  topics = ["app_subscriptions/update"]
  uri = "/webhook/shopify-billing/subscriptions"

  [[webhooks.subscriptions]]
  topics = ["app_purchases_one_time/update"]
  uri = "/webhook/shopify-billing/purchases"

  # GDPR mandatory webhooks
  [[webhooks.subscriptions]]
  topics = ["customers/redact"]
  uri = "/webhook/customers/redact"

  [[webhooks.subscriptions]]
  topics = ["customers/data_request"]
  uri = "/webhook/customers/data_request"

  [[webhooks.subscriptions]]
  topics = ["shop/redact"]
  uri = "/webhook/shop/redact"

[build]
automatically_update_urls_on_dev = true

[application_url]
application_url = "https://app.cardflowlabs.com"

[embedded_app]
embedded = true
